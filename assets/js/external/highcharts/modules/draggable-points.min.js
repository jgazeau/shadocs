"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/draggable-points",["highcharts"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){function t(e,t,r,o){e.hasOwnProperty(t)||(e[t]=o.apply(null,r),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:e[t]}})))}t(e=e?e._modules:{},"Extensions/DraggablePoints.js",[e["Core/Animation/AnimationUtilities.js"],e["Core/Chart/Chart.js"],e["Core/Globals.js"],e["Core/Series/Point.js"],e["Core/Series/Series.js"],e["Core/Series/SeriesRegistry.js"],e["Core/Utilities.js"]],function(e,t,r,o,a,i,n){function l(e){return{left:"right",right:"left",top:"bottom",bottom:"top"}[e]}function s(e){let t=e.series?e.series.length:0;if(e.hasCartesianSeries&&!e.polar||e.mapView)for(;t--;)if(e.series[t].options.dragDrop&&function(e){const t=["draggableX","draggableY"];H(e.dragDropProps,function(e){e.optionName&&t.push(e.optionName)});let r=t.length;for(;r--;)if(e.options.dragDrop[t[r]])return 1}(e.series[t]))return 1}function u(e,t){return void 0===e.chartX||void 0===e.chartY?t.pointer.normalize(e):e}function c(t,e,r,o){const a=e.map(function(e){return P(t,e,r,o)});return function(){a.forEach(function(e){e()})}}function x(e,t){const r=function(t){const r=t.series,o=r.options.dragDrop.groupBy;let a=[];return r.boosted?r.options.data.forEach(function(e,t){a.push((new r.pointClass).init(r,e)),a[a.length-1].index=t}):a=r.points,t.options[o]?a.filter(function(e){return e.options[o]===t.options[o]}):[t]}(t),o=t.series,a=o.chart;let i;A(o.options.dragDrop&&o.options.dragDrop.liveRedraw,!0)||(a.dragGuideBox=i=o.getGuideBox(r),a.setGuideBoxState("default",o.options.dragDrop.guideBox).add(o.group)),a.dragDropData={origin:function(a,e,t){const i={chartX:a.chartX,chartY:a.chartY,guideBox:t&&{x:t.attr("x"),y:t.attr("y"),width:t.attr("width"),height:t.attr("height")},points:{}};return e.forEach(function(r){const o={};H(r.series.dragDropProps,function(e,t){e=r.series[e.axis+"Axis"],o[t]=r[t],o[t+"Offset"]=r.series.chart.mapView&&r.plotX&&r.plotY?"x"===t?r.plotX:r.plotY:e.toPixels(r[t])-(e.horiz?a.chartX:a.chartY)}),o.point=r,i.points[r.id]=o}),i}(e,r,i),point:t,groupedPoints:r,isDragging:!0}}function h(e,t){var r=e.dragDropData.newPoints;t=D(t),e.isDragDropAnimating=!0,H(r,function(e){e.point.update(e.newValues,!1)}),e.redraw(t),setTimeout(function(){delete e.isDragDropAnimating,e.hoverPoint&&!e.dragHandles&&e.hoverPoint.showDragHandles()},t.duration)}function m(e){const t=e.series&&e.series.chart,r=t&&t.dragDropData;!t||!t.dragHandles||r&&(r.isDragging&&r.draggedPastSensitivity||r.isHoveringHandle===e.id)||t.hideDragHandles()}function d(e){let t=0;for(const r in e)Object.hasOwnProperty.call(e,r)&&t++;return t}function f(e){for(const t in e)if(Object.hasOwnProperty.call(e,t))return e[t]}function p(p,e){var t,g,r,o,a,i,n,s;e.zoomOrPanKeyPressed(p)||(r=0,(t=e.dragDropData)&&t.isDragging&&t.point.series&&(r=(g=t.point).series.options.dragDrop,p.preventDefault(),t.draggedPastSensitivity||(t.draggedPastSensitivity=(o=p,a=e,i=A(g.options.dragDrop&&g.options.dragDrop.dragSensitivity,r&&r.dragSensitivity,2),n=a.dragDropData.origin,a=n.chartX,n=n.chartY,s=o.chartX,o=o.chartY,Math.sqrt((s-a)*(s-a)+(o-n)*(o-n))>i)),t.draggedPastSensitivity&&(t.newPoints=function(t,r){const e=t.point,o=e.series,a=o.chart,i=z(o.options.dragDrop,e.options.dragDrop),n={},s=t.updateProp,d={};return H(e.series.dragDropProps,function(e,t){s&&(s!==t||!e.resize||e.optionName&&!1===i[e.optionName])||(s||e.move&&("x"===e.axis&&i.draggableX||"y"===e.axis&&i.draggableY))&&(a.mapView?n["x"===t?"lon":"lat"]=e:n[t]=e)}),(s?[e]:t.groupedPoints).forEach(function(e){d[e.id]={point:e,newValues:e.getDropValues(t.origin,r,n)}}),d}(t,p),e=1===(r=d(e=t.newPoints))?f(e):null,g.firePointEvent("drag",{origin:t.origin,newPoints:t.newPoints,newPoint:e&&e.newValues,newPointId:e&&e.point.id,numNewPoints:r,chartX:p.chartX,chartY:p.chartY},function(){{var t=g.series,r=t.chart,o=r.dragDropData,a=z(t.options.dragDrop,g.options.dragDrop),i=a.draggableX,n=a.draggableY,t=o.origin,s=o.updateProp,o=p.chartX-t.chartX;let e=p.chartY-t.chartY;var d=o;if(r.inverted&&(o=-e,e=-d),A(a.liveRedraw,!0))h(r,!1),g.showDragHandles();else if(s){n=o,r=e,a=(s=(d=g.series).chart).dragDropData,i=d.dragDropProps[a.updateProp];const p=a.newPoints[g.id].newValues,t="function"==typeof i.resizeSide?i.resizeSide(p,g):i.resizeSide;i.beforeResize&&i.beforeResize(s.dragGuideBox,p,g);{s=s.dragGuideBox,d="x"===i.axis&&d.xAxis.reversed||"y"===i.axis&&d.yAxis.reversed?l(t):t,n="x"===i.axis?n-(a.origin.prevdX||0):0,r="y"===i.axis?r-(a.origin.prevdY||0):0;let e;switch(d){case"left":e={x:s.attr("x")+n,width:Math.max(1,s.attr("width")-n)};break;case"right":e={width:Math.max(1,s.attr("width")+n)};break;case"top":e={y:s.attr("y")+r,height:Math.max(1,s.attr("height")-r)};break;case"bottom":e={height:Math.max(1,s.attr("height")+r)}}s.attr(e)}}else r.dragGuideBox.translate(i?o:0,n?e:0);t.prevdX=o,t.prevdY=e}}))))}function g(e,t){var r=t.dragDropData;if(r&&r.isDragging&&r.draggedPastSensitivity&&r.point.series){const o=r.point,a=r.newPoints,i=d(a),n=1===i?f(a):null;t.dragHandles&&t.hideDragHandles(),e.preventDefault(),t.cancelClick=!0,o.firePointEvent("drop",{origin:r.origin,chartX:e.chartX,chartY:e.chartY,newPoints:a,numNewPoints:i,newPoint:n&&n.newValues,newPointId:n&&n.point.id},function(){h(t)})}delete t.dragDropData,t.dragGuideBox&&(t.dragGuideBox.destroy(),delete t.dragGuideBox)}function y(a){var e=a.container,t=r.doc;s(a)&&(c(e,["mousedown","touchstart"],function(e){{e=u(e,a);const o=a.hoverPoint;var t=(r=z(o&&o.series.options.dragDrop,o&&o.options.dragDrop)).draggableX||!1,r=r.draggableY||!1;a.cancelClick=!1,!t&&!r||a.zoomOrPanKeyPressed(e)||a.hasDraggedAnnotation||(a.dragDropData&&a.dragDropData.isDragging?g(e,a):o&&function(e){var t=e.series,r=t.chart,o=t.options.dragDrop||{};e=e.options&&e.options.dragDrop;let a,i;return H(t.dragDropProps,function(e){"x"===e.axis&&e.move?a=!0:"y"===e.axis&&e.move&&(i=!0)}),(o.draggableX&&a||o.draggableY&&i)&&(!e||!1!==e.draggableX||!1!==e.draggableY)&&(t.yAxis&&t.xAxis||r.mapView)}(o)&&(a.mouseIsDown=!1,x(e,o),o.firePointEvent("dragStart",e)))}}),c(e,["mousemove","touchmove"],function(e){p(u(e,a),a)},{passive:!1}),P(e,"mouseleave",function(e){g(u(e,a),a)}),a.unbindDragDropMouseUp=c(t,["mouseup","touchend"],function(e){g(u(e,a),a)},{passive:!1}),a.hasAddedDragDropEvents=!0,P(a,"destroy",function(){a.unbindDragDropMouseUp&&a.unbindDragDropMouseUp()}))}const D=e["animObject"],v=i["seriesTypes"],{addEvent:P,clamp:w,isNumber:b,merge:z,objectEach:H,pick:A}=n,S=(e=function(e){var t=(e=e.shapeArgs||e.graphic.getBBox()).r||0,r=e.height/2;return[["M",0,t],["L",0,r-5],["A",1,1,0,0,0,0,5+r],["A",1,1,0,0,0,0,r-5],["M",0,5+r],["L",0,e.height-t]]},i=a.prototype.dragDropProps={x:{axis:"x",move:!0},y:{axis:"y",move:!0}},v.flags&&(v.flags.prototype.dragDropProps=i),v.column.prototype.dragDropProps={x:{axis:"x",move:!0},y:{axis:"y",move:!1,resize:!0,beforeResize:function(e,t,r){var o=A(r.yBottom,r.series.translatedThreshold),a=e.attr("y"),i=b(r.stackY)?r.stackY-(r.y||0):r.series.options.threshold||0;t=i+t.y,(r.series.yAxis.reversed?t<i:i<=t)?(r=e.attr("height"),e.attr({height:Math.max(0,Math.round(r+(o?o-a-r:0)))})):e.attr({y:Math.round(a+(o?o-a:0))})},resizeSide:function(e,t){const r=t.series.chart.dragHandles;return t=l(e=e.y>=(t.series.options.threshold||0)?"top":"bottom"),r&&r[t]&&(r[t].destroy(),delete r[t]),e},handlePositioner:function(e){var t=e.shapeArgs||e.graphic&&e.graphic.getBBox()||{},r=e.series.yAxis.reversed,o=e.series.options.threshold||0;return e=e.y||0,{x:t.x||0,y:!r&&o<=e||r&&e<o?t.y||0:(t.y||0)+(t.height||0)}},handleFormatter:function(e){var t=e.shapeArgs||{},r=(e=t.r||0,(t=t.width||0)/2);return[["M",e,0],["L",r-5,0],["A",1,1,0,0,0,5+r,0],["A",1,1,0,0,0,r-5,0],["M",5+r,0],["L",t-e,0]]}}});if(v.bullet&&(v.bullet.prototype.dragDropProps={x:S.x,y:S.y,target:{optionName:"draggableTarget",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){var t=e.targetGraphic.getBBox();return{x:e.barX,y:t.y+t.height/2}},handleFormatter:S.y.handleFormatter}}),v.columnrange&&(v.columnrange.prototype.dragDropProps={x:{axis:"x",move:!0},low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:(e=e.shapeArgs||e.graphic.getBBox()).x||0,y:(e.y||0)+(e.height||0)}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.high}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:(e=e.shapeArgs||e.graphic.getBBox()).x||0,y:e.y||0}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e>=t.low}}}),v.boxplot&&(v.boxplot.prototype.dragDropProps={x:S.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x||0,y:e.lowPlot}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.q1}},q1:{optionName:"draggableQ1",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x||0,y:e.q1Plot}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.median&&e>=t.low}},median:{axis:"y",move:!0},q3:{optionName:"draggableQ3",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x||0,y:e.q3Plot}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.high&&e>=t.median}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x||0,y:e.highPlot}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e>=t.q3}}}),v.ohlc&&(v.ohlc.prototype.dragDropProps={x:S.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotLow}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.open&&e<=t.close}},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotHigh}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e>=t.open&&e>=t.close}},open:{optionName:"draggableOpen",axis:"y",move:!0,resize:!0,resizeSide:function(e){return e.open>=e.close?"top":"bottom"},handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotOpen}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.high&&e>=t.low}},close:{optionName:"draggableClose",axis:"y",move:!0,resize:!0,resizeSide:function(e){return e.open>=e.close?"bottom":"top"},handlePositioner:function(e){return{x:e.shapeArgs.x,y:e.plotClose}},handleFormatter:S.y.handleFormatter,propValidate:function(e,t){return e<=t.high&&e>=t.low}}}),v.arearange&&(i=v.columnrange.prototype.dragDropProps,n=function(e){return[["M",0-(e=e.graphic?e.graphic.getBBox().width/2+1:4),0],["a",e,e,0,1,0,2*e,0],["a",e,e,0,1,0,-2*e,0]]},v.arearange.prototype.dragDropProps={x:i.x,low:{optionName:"draggableLow",axis:"y",move:!0,resize:!0,resizeSide:"bottom",handlePositioner:function(e){return(e=e.graphics&&e.graphics[0]&&e.graphics[0].getBBox())?{x:e.x+e.width/2,y:e.y+e.height/2}:{x:-999,y:-999}},handleFormatter:n,propValidate:i.low.propValidate},high:{optionName:"draggableHigh",axis:"y",move:!0,resize:!0,resizeSide:"top",handlePositioner:function(e){return(e=e.graphics&&e.graphics[1]&&e.graphics[1].getBBox())?{x:e.x+e.width/2,y:e.y+e.height/2}:{x:-999,y:-999}},handleFormatter:n,propValidate:i.high.propValidate}}),v.waterfall&&(v.waterfall.prototype.dragDropProps={x:S.x,y:z(S.y,{handleFormatter:function(e){return e.isSum||e.isIntermediateSum?null:S.y.handleFormatter(e)}})}),v.xrange){const F=function(e,t){var r=e.series;const o=r.xAxis,a=r.yAxis,i=r.chart.inverted;return r=r.columnMetrics?r.columnMetrics.offset:-e.shapeArgs.height/2,t=o.toPixels(e[t],!0),e=a.toPixels(e.y,!0),i&&(t=o.len-t,e=a.len-e),{x:Math.round(t),y:Math.round(e+r)}};e=v.xrange.prototype.dragDropProps={y:{axis:"y",move:!0},x:{optionName:"draggableX1",axis:"x",move:!0,resize:!0,resizeSide:"left",handlePositioner:function(e){return F(e,"x")},handleFormatter:e,propValidate:function(e,t){return e<=t.x2}},x2:{optionName:"draggableX2",axis:"x",move:!0,resize:!0,resizeSide:"right",handlePositioner:function(e){return F(e,"x2")},handleFormatter:e,propValidate:function(e,t){return e>=t.x}}},v.gantt&&(v.gantt.prototype.dragDropProps={y:e.y,start:z(e.x,{optionName:"draggableStart",validateIndividualDrag:function(e){return!e.milestone}}),end:z(e.x2,{optionName:"draggableEnd",validateIndividualDrag:function(e){return!e.milestone}})})}"gauge pie sunburst wordcloud sankey histogram pareto vector windbarb treemap bellcurve sma map mapline".split(" ").forEach(function(e){v[e]&&(v[e].prototype.dragDropProps=null)});const B={default:{className:"highcharts-drag-box-default",lineWidth:1,lineColor:"#888",color:"rgba(0, 0, 0, 0.1)",cursor:"move",zIndex:900}},N={className:"highcharts-drag-handle",color:"#fff",lineColor:"rgba(0, 0, 0, 0.6)",lineWidth:1,zIndex:901};t.prototype.setGuideBoxState=function(e,t){const r=this.dragGuideBox;return t=z(B,t),e=z(t.default,t[e]),r.attr({class:e.className,stroke:e.lineColor,strokeWidth:e.lineWidth,fill:e.color,cursor:e.cursor,zIndex:e.zIndex}).css({pointerEvents:"none"})},o.prototype.getDropValues=function(e,d,t){const p=this,g=p.series,l=g.chart,h=l.mapView,u=z(g.options.dragDrop,p.options.dragDrop),c={},x=e.points[p.id];let m;for(const e in t)if(Object.hasOwnProperty.call(t,e)){if(void 0!==m){m=!1;break}m=!0}return H(t,function(e,t){var r,o,a,i,n=x.point[t],s=g[e.axis+"Axis"];s=h?(a=e.axis.toUpperCase(),h?(s=A(u["dragPrecision"+a],0),i=h.pixelsToLonLat({x:0,y:0}),r=h.pixelsToLonLat({x:l.plotBox.width,y:l.plotBox.height}),i=A(u["dragMin"+a],i&&i[t],-1/0),a=A(u["dragMax"+a],r&&r[t],1/0),r=d[t],"Orthographic"===h.projection.options.name?r:("lat"===t&&((isNaN(i)||i>h.projection.maxLatitude)&&(i=h.projection.maxLatitude),o=a=isNaN(a)||a<-1*h.projection.maxLatitude?-1*h.projection.maxLatitude:a,a=i,i=o),h.projection.hasCoordinates||(o=h.pixelsToLonLat({x:d.chartX-l.plotLeft,y:l.plotHeight-d.chartY+l.plotTop}))&&(r=o[t]),s&&(r=Math.round(r/s)*s),w(r,i,a))):void 0):(s=s.toValue((s.horiz?d.chartX:d.chartY)+x[t+"Offset"]),r=e.axis.toUpperCase(),i=g[r.toLowerCase()+"Axis"].categories?1:0,i=A(u["dragPrecision"+r],i),a=A(u["dragMin"+r],-1/0),r=A(u["dragMax"+r],1/0),i&&(s=Math.round(s/i)*i),w(s,a,r)),!b(s)||m&&e.propValidate&&!e.propValidate(s,p)||void 0===n||(c[t]=s)}),c},a.prototype.getGuideBox=function(e){const t=this.chart;let a=1/0,i=-1/0,n=1/0,s=-1/0,d;return e.forEach(function(t){var r=t.graphic&&t.graphic.getBBox()||t.shapeArgs;if(r){let e;var o=t.x2;b(o)&&(e=t.series.xAxis.translate(o,!1,!1,!1,!0)),o=!(r.width||r.height||r.x||r.y),d=!0,a=Math.min(t.plotX||0,e||0,o?1/0:r.x||0,a),i=Math.max(t.plotX||0,e||0,(r.x||0)+(r.width||0),i),n=Math.min(t.plotY||0,o?1/0:r.y||0,n),s=Math.max((r.y||0)+(r.height||0),s)}}),d?t.renderer.rect(a,n,i-a,s-n):t.renderer.g()},o.prototype.showDragHandles=function(){const s=this,d=s.series,p=d.chart,{inverted:g,renderer:l}=p,h=z(d.options.dragDrop,s.options.dragDrop);H(d.dragDropProps,function(e,r){var t=z(N,e.handleOptions,h.dragHandle);const o={class:t.className,"stroke-width":t.lineWidth,fill:t.color,stroke:t.lineColor};var a=t.pathFormatter||e.handleFormatter,i=e.handlePositioner,n=!e.validateIndividualDrag||e.validateIndividualDrag(s);e.resize&&n&&e.resizeSide&&a&&(h["draggable"+e.axis.toUpperCase()]||h[e.optionName])&&!1!==h[e.optionName]&&(p.dragHandles||(p.dragHandles={group:l.g("drag-drop-handles").add(d.markerGroup||d.group)}),p.dragHandles.point=s.id,i=i(s),o.d=a=a(s),n=s.series.xAxis.categories?-.5:0,!a||i.x<n||i.y<0||(o.cursor=t.cursor||("x"===e.axis!=!!g?"ew-resize":"ns-resize"),(t=p.dragHandles[e.optionName])||(t=p.dragHandles[e.optionName]=l.path().add(p.dragHandles.group)),o.translateX=g?d.yAxis.len-i.y:i.x,o.translateY=g?d.xAxis.len-i.x:i.y,g&&(o.rotation=-90),t.attr(o),c(t.element,["touchstart","mousedown"],function(e){{e=u(e,p);const t=s.series.chart;t.zoomOrPanKeyPressed(e)||(t.mouseIsDown=!1,x(e,s),t.dragDropData.updateProp=e.updateProp=r,s.firePointEvent("dragStart",e),e.stopPropagation(),e.preventDefault())}},{passive:!1}),P(p.dragHandles.group.element,"mouseover",function(){p.dragDropData=p.dragDropData||{},p.dragDropData.isHoveringHandle=s.id}),c(p.dragHandles.group.element,["touchend","mouseout"],function(){{const e=s.series.chart;e.dragDropData&&s.id===e.dragDropData.isHoveringHandle&&delete e.dragDropData.isHoveringHandle,e.hoverPoint||m(s)}})))})},t.prototype.hideDragHandles=function(){this.dragHandles&&(H(this.dragHandles,function(e,t){"group"!==t&&e.destroy&&e.destroy()}),this.dragHandles.group&&this.dragHandles.group.destroy&&this.dragHandles.group.destroy(),delete this.dragHandles)},P(o,"mouseOver",function(){const a=this;setTimeout(function(){{const e=a.series,t=e&&e.chart,r=t&&t.dragDropData,o=t&&t.is3d&&t.is3d();!t||r&&r.isDragging&&r.draggedPastSensitivity||t.isDragDropAnimating||!e.options.dragDrop||o||(t.dragHandles&&t.hideDragHandles(),a.showDragHandles())}},12)}),P(o,"mouseOut",function(){const e=this;setTimeout(function(){e.series&&m(e)},10)}),P(o,"remove",function(){const e=this.series.chart,t=e.dragHandles;t&&t.point===this.id&&e.hideDragHandles()}),t.prototype.zoomOrPanKeyPressed=function(e){var t=this.options.chart||{},r=t.panKey&&t.panKey+"Key";return e[t.zooming.key&&t.zooming.key+"Key"]||e[r]},P(t,"render",function(){this.hasAddedDragDropEvents||y(this)})}),t(e,"masters/modules/draggable-points.src.js",[],function(){})});