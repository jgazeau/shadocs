!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:o[t]}})))}t(o=o?o._modules:{},"Series/NodesComposition.js",[o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(o,t){var e,i,n=(o=o.series).prototype,d=o.prototype.pointClass.prototype,s=t.defined,r=t.extend,a=t.find,h=t.merge,p=t.pick;function l(){return this.data=[].concat(this.points||[],this.nodes),n.destroy.apply(this,arguments)}function c(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),n.setData.apply(this,arguments)}function u(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(d.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&d.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&d.setState.apply(o.toNode,t)))}),d.setState.apply(this,t)}function f(o,t,e,i){var n=this,s=this.series.options.nodes,r=this.series.options.data,a=r&&r.length||0,l=r&&r[this.index];d.update.call(this,o,!this.isNode&&t,e,i),this.isNode&&(o=(s||[]).reduce(function(o,t,e){return n.id===t.id?e:o},-1),i=h(s&&s[o]||{},r&&r[this.index]||{}),r&&(l?r[this.index]=l:r.length=a),s?0<=o?s[o]=i:s.push(i):this.series.options.nodes=[i],p(t,!0)&&this.series.chart.redraw(e))}return o=e=e||{},i=[],o.compose=function(o,t){return-1===i.indexOf(o)&&(i.push(o),(o=o.prototype).setNodeState=u,o.setState=u,o.update=f),-1===i.indexOf(t)&&(i.push(t),(o=t.prototype).destroy=l,o.setData=c),t},o.createNode=function(o){var n,t=this.pointClass,e=function(o,t){return a(o,function(o){return o.id===t})},i=e(this.nodes,o);return i||(e=this.options.nodes&&e(this.options.nodes,o),(n=(new t).init(this,r({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight||0}),n.linksFrom.forEach(function(o){e+=o.weight||0}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},n.index=this.nodes.push(n)-1,i=n),i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=p(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},o.destroy=l,o.generatePoints=function(){var t=this,e=this.chart,i={};n.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){s(o.from)&&(i[o.from]||(i[o.from]=t.createNode(o.from)),i[o.from].linksFrom.push(o),o.fromNode=i[o.from],e.styledMode?o.colorIndex=p(o.options.colorIndex,i[o.from].colorIndex):o.color=o.options.color||i[o.from].color),s(o.to)&&(i[o.to]||(i[o.to]=t.createNode(o.to)),i[o.to].linksTo.push(o),o.toNode=i[o.to]),o.name=o.name||o.id},this),this.nodeLookup=i},o.setNodeState=u,o.updateNode=f,e}),t(o,"Series/Sankey/SankeyPoint.js",[o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(e,o,t){var i,n,s=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),r=t.defined;return n=o.seriesTypes.column.prototype.pointClass,s(a,n),a.prototype.applyOptions=function(o,t){return e.prototype.applyOptions.call(this,o,t),r(this.options.level)&&(this.options.column=this.column=this.options.level),this},a.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},a.prototype.getFromNode=function(){for(var o,t=-1,e=0;e<this.linksTo.length;e++){var i=this.linksTo[e];i.fromNode.column>t&&i.fromNode!==this&&(t=(o=i.fromNode).column)}return{fromNode:o,fromColumn:t}},a.prototype.setNodeColumn=function(){r(this.options.column)||(this.column=0===this.linksTo.length?0:this.getFromNode().fromColumn+1)},a.prototype.isValid=function(){return this.isNode||"number"==typeof this.weight},a;function a(){var o=null!==n&&n.apply(this,arguments)||this;return o.className=void 0,o.fromNode=void 0,o.level=void 0,o.linkBase=void 0,o.linksFrom=void 0,o.linksTo=void 0,o.mass=void 0,o.nodeX=void 0,o.nodeY=void 0,o.options=void 0,o.series=void 0,o.toNode=void 0,o}}),t(o,"Series/Sankey/SankeyColumnComposition.js",[o["Core/Utilities.js"]],function(o){var t,p=o.defined,c=o.relativeLength,o=t=t||{},e=(o.compose=function(o,t){return o.sankeyColumn=new e(o,t),o},i.prototype.getTranslationFactor=function(o){for(var t,e=this.points,i=e.slice(),n=o.options.minLinkWidth||0,s=0,r=(o.chart.plotSizeY||0)-(o.options.borderWidth||0)-(e.length-1)*o.nodePadding;e.length;){for(s=r/e.sankeyColumn.sum(),o=!1,t=e.length;t--;)e[t].getSum()*s<n&&(e.splice(t,1),r-=n,o=!0);if(!o)break}return e.length=0,i.forEach(function(o){e.push(o)}),s},i.prototype.top=function(e){var i=this.series,n=i.nodePadding,o=this.points.reduce(function(o,t){return 0<o&&(o+=n),o+(t=Math.max(t.getSum()*e,i.options.minLinkWidth||0))},0);return((i.chart.plotSizeY||0)-o)/2},i.prototype.left=function(e){var i=this.series,o=i.chart,n=i.options.equalNodes,s=o.inverted?o.plotHeight:o.plotWidth,r=i.nodePadding,t=this.points.reduce(function(o,t){return 0<o&&(o+=r),o+(t=n?s/t.series.nodes.length-r:Math.max(t.getSum()*e,i.options.minLinkWidth||0))},0);return((o.plotSizeX||0)-Math.round(t))/2},i.prototype.sum=function(){return this.points.reduce(function(o,t){return o+t.getSum()},0)},i.prototype.offset=function(o,t){var e=this.points,i=this.series,n=i.nodePadding,s=0;if(i.is("organization")&&o.hangsFrom)return{absoluteTop:o.hangsFrom.nodeY};for(var r=0;r<e.length;r++){var a=e[r].getSum(),l=Math.max(a*t,i.options.minLinkWidth||0),d=o.options[i.chart.inverted?"offsetHorizontal":"offsetVertical"],h=o.options.offset||0,a=a?l+n:0;if(e[r]===o)return{relativeTop:s+(p(d)?c(d,l):c(h,a))};s+=a}},i);function i(o,t){this.points=o,this.series=t}return o.SankeyColumnAdditions=e,t}),t(o,"Series/TreeUtilities.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(f,o){var h=o.extend,r=o.isArray,a=o.isNumber,l=o.isObject,d=o.merge,m=o.pick;return{getColor:function(o,t){var e,i,n,s=t.index,r=t.mapOptionsToLevel,a=t.parentColor,l=t.parentColorIndex,d=t.series,h=t.colors,p=t.siblings,c=d.points,u=d.chart.options.chart;return o&&(c=c[o.i],o=r[o.level]||{},c&&o.colorByPoint&&(i=c.index%(h?h.length:u.colorCount),n=h&&h[i]),d.chart.styledMode||(h=c&&c.options.color,u=o&&o.color,(e=a)&&(e=(e=o&&o.colorVariation)&&"brightness"===e.key&&s&&p?f.parse(a).brighten(s/p*e.to).get():a),e=m(h,u,n,e,d.color)),n=m(c&&c.options.colorIndex,o&&o.colorIndex,i,l,t.colorIndex)),{color:e,colorIndex:n}},getLevelOptions:function(o){var t=null;if(l(o)){var t={},n=a(o.from)?o.from:1,e=o.levels,i={},s=l(o.defaults)?o.defaults:{};for(r(e)&&(i=e.reduce(function(o,t){var e,i;return l(t)&&a(t.level)&&(e=d({},t),i=m(e.levelIsConstant,s.levelIsConstant),delete e.levelIsConstant,delete e.level,t=t.level+(i?0:n-1),l(o[t])?d(!0,o[t],e):o[t]=e),o},{})),e=a(o.to)?o.to:1,o=0;o<=e;o++)t[o]=d({},s,l(i[o])?i[o]:{})}return t},setTreeValues:function i(n,s){var o=s.before,t=s.idRoot,e=s.mapIdToNode[t],r=s.points[n.i],a=r&&r.options||{},l=[],d=0;return n.levelDynamic=n.level-(!1!==s.levelIsConstant?0:e.level),n.name=m(r&&r.name,""),n.visible=t===n.id||!0===s.visible,(n="function"==typeof o?o(n,s):n).children.forEach(function(o,t){var e=h({},s);h(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),l.push(o),o.visible&&(d+=o.val)}),o=m(a.value,d),n.visible=0<=o&&(0<d||n.visible),n.children=l,n.childrenTotal=d,n.isLeaf=n.visible&&!d,n.val=o,n},updateRootId:function(o){var t;return l(o)&&(t=l(o.options)?o.options:{},t=m(o.rootNode,t.rootId,""),l(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Color/Color.js"],o["Core/Globals.js"],o["Series/NodesComposition.js"],o["Series/Sankey/SankeyPoint.js"],o["Core/Series/SeriesRegistry.js"],o["Series/Sankey/SankeyColumnComposition.js"],o["Series/TreeUtilities.js"],o["Core/Utilities.js"]],function(a,o,t,e,i,n,s,r){var l,d,h=this&&this.__extends||(l=function(o,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}l(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),p=i.series,c=i.seriesTypes.column,u=s.getLevelOptions,f=(s=r.extend,r.isObject),m=r.merge,v=r.pick,y=r.relativeLength,g=r.stableSort;function k(){var o=null!==d&&d.apply(this,arguments)||this;return o.colDistance=void 0,o.data=void 0,o.group=void 0,o.nodeLookup=void 0,o.nodePadding=void 0,o.nodes=void 0,o.nodeWidth=void 0,o.options=void 0,o.points=void 0,o.translationFactor=void 0,o}return h(k,d=c),k.getDLOptions=function(o){var t=f(o.optionsPoint)?o.optionsPoint.dataLabels:{};return o=f(o.level)?o.level.dataLabels:{},m({style:{}},o,t)},k.prototype.createNodeColumns=function(){var t=[];this.nodes.forEach(function(o){o.setNodeColumn(),t[o.column]||(t[o.column]=n.compose([],this)),t[o.column].push(o)},this);for(var o=0;o<t.length;o++)void 0===t[o]&&(t[o]=n.compose([],this));return t},k.prototype.generatePoints=function(){t.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){o.toNode&&t(o.toNode,e+1)}))}(o,0)}),g(this.nodes,function(o,t){return o.level-t.level}))},k.prototype.getNodePadding=function(){var o,t=this.options.nodePadding||0;return t=this.nodeColumns&&(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY?this.chart.plotSizeY/o:t},k.prototype.hasData=function(){return!!this.processedXData.length},k.prototype.pointAttribs=function(o,t){if(!o)return{};var e=this,i=e.mapOptionsToLevel[(o.isNode?o:o.fromNode).level||0]||{},n=o.options,s=i.states&&i.states[t||""]||{},r=(t=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce(function(o,t){return o[t]=v(s[t],n[t],i[t],e.options[t]),o},{}),v(s.color,n.color,(t.colorByPoint?o:i).color));return o.isNode?{fill:r,stroke:t.borderColor,"stroke-width":t.borderWidth,opacity:t.opacity}:{fill:a.parse(r).setOpacity(t.linkOpacity).get()}},k.prototype.render=function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),c.prototype.render.call(this),this.points=o},k.prototype.translate=function(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=y(this.options.nodeWidth,this.chart.plotSizeX);var e=this,o=this.chart,t=this.options,i=this.nodeWidth,n=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=n.reduce(function(o,t){return Math.min(o,t.sankeyColumn.getTranslationFactor(e))},1/0),this.colDistance=(o.plotSizeX-i-t.borderWidth)/Math.max(1,n.length-1),e.mapOptionsToLevel=u({from:1,levels:t.levels,to:n.length-1,defaults:{borderColor:t.borderColor,borderRadius:t.borderRadius,borderWidth:t.borderWidth,color:e.color,colorByPoint:t.colorByPoint,levelIsConstant:!0,linkColor:t.linkColor,linkLineWidth:t.linkLineWidth,linkOpacity:t.linkOpacity,states:t.states}}),n.forEach(function(t){t.forEach(function(o){e.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){(o.weight||o.isNull)&&o.to&&(e.translateLink(o),o.allowShadow=!1)})})},k.prototype.translateLink=function(e){var o,t,i,n,s,r,a,l,d,h,p,c,u,f=function(o,t){return t=o.offset(e,t)*g,Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-k)},m=e.fromNode,v=e.toNode,y=this.chart,g=this.translationFactor,k=Math.max(e.weight*g,this.options.minLinkWidth),C=(y.inverted?-this.colDistance:this.colDistance)*this.options.curveFactor,N=f(m,"linksFrom"),f=f(v,"linksTo"),S=m.nodeX,b=this.nodeWidth,v=v.nodeX,x=e.outgoing,L=S+b<v;y.inverted&&(N=y.plotSizeY-N,f=(y.plotSizeY||0)-f,b=-b,k=-k,L=v<S),e.shapeType="path",e.linkBase=[N,N+k,f,f+k],L&&"number"==typeof f?e.shapeArgs={d:[["M",S+b,N],["C",S+b+C,N,v-C,f,v,f],["L",v+(x?b:0),f+k/2],["L",v,f+k],["C",v-C,f+k,S+b+C,N+k,S+b,N+k],["Z"]]}:"number"==typeof f&&(C=v-20-k,t=(o=(L=S+b)+20)+k,a=(r=(s=(n=(i=(h=N)+k)+20)+(y.plotHeight-N-k))+20)+k,d=(l=f)+k,p=r+.7*k,c=v-.7*k,u=L+.7*k,e.shapeArgs={d:[["M",L,h],["C",u,h,t,i-.7*k,t,n],["L",t,s],["C",t,p,u,a,L,a],["L",v,a],["C",c,a,C,p,C,s],["L",C,h=d+20],["C",C,d-.7*k,c,l,v,l],["L",v,d],["C",x=v-20,d,x,d,x,h],["L",x,s],["C",x,r,x,r,v,r],["L",L,r],["C",o,r,o,r,o,s],["L",o,n],["C",o,i,o,i,L,i],["Z"]]}),e.dlBox={x:S+(v-S+b)/2,y:N+(f-N)/2,height:k,width:0},e.tooltipPos=y.inverted?[y.plotSizeY-e.dlBox.y-k/2,y.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+k/2],e.y=e.plotY=1,e.x=e.plotX=1,e.color||(e.color=m.color)},k.prototype.translateNode=function(o,t){var e,i=this.translationFactor,n=this.chart,s=this.options,r=o.getSum(),a=Math.max(Math.round(r*i),this.options.minLinkWidth),l=Math.round(this.nodeWidth),d=Math.round(s.borderWidth)%2/2,h=t.sankeyColumn.offset(o,i);t=Math.floor(v(h.absoluteTop,t.sankeyColumn.top(i)+h.relativeTop))+d,d=Math.floor(this.colDistance*o.column+s.borderWidth/2)+y(o.options.offsetHorizontal||0,l)+d,d=n.inverted?n.plotSizeX-d:d,(o.sum=r)?(o.shapeType="rect",r=o.nodeX=d,i=o.nodeY=t,h=o.options.width||s.width||l,e=o.options.height||s.height||a,n.inverted&&(r=d-l,i=n.plotSizeY-t-a,h=o.options.height||s.height||l,e=o.options.width||s.width||a),o.dlOptions=k.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=n.inverted?[n.plotSizeY-i-e/2,n.plotSizeX-r-h/2]:[r+h/2,i+e/2],o.shapeArgs={x:r,y:i,width:h,height:e,display:o.hasShape()?"":"none"}):o.dlOptions={enabled:!1}},k.defaultOptions=m(c.defaultOptions,{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,opacity:1,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} → {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}),t.compose(e,r=k),s(r.prototype,{animate:p.prototype.animate,createNode:t.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:e,searchPoint:o.noop}),i.registerSeriesType("sankey",r),r}),t(o,"masters/modules/sankey.src.js",[],function(){})});