"use strict";!function(o){"object"==typeof module&&module.exports?module.exports=o.default=o:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(t){return o(t),o.Highcharts=t,o}):o("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function o(t,o,e,i){t.hasOwnProperty(o)||(t[o]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:o,module:t[o]}})))}o(t=t?t._modules:{},"Series/NodesComposition.js",[t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(t,e){const{prototype:i,prototype:{pointClass:{prototype:l}}}=t["series"],{defined:s,extend:n,find:r,merge:h,pick:d}=e;var o;{function a(){return this.data=[].concat(this.points||[],this.nodes),i.destroy.apply(this,arguments)}function p(){this.nodes&&(this.nodes.forEach(t=>{t.destroy()}),this.nodes.length=0),i.setData.apply(this,arguments)}function c(t){const o=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&e.forEach(t=>{t&&t.series&&(l.setState.apply(t,o),t.isNode||(t.fromNode.graphic&&l.setState.apply(t.fromNode,o),t.toNode&&t.toNode.graphic&&l.setState.apply(t.toNode,o)))}),l.setState.apply(this,o)}function u(t,o,e,i){const s=this.series.options.nodes,n=this.series.options.data,r=n&&n.length||0,a=n&&n[this.index];l.update.call(this,t,!this.isNode&&o,e,i),this.isNode&&(t=(s||[]).reduce((t,o,e)=>this.id===o.id?e:t,-1),i=h(s&&s[t]||{},n&&n[this.index]||{}),n&&(a?n[this.index]=a:n.length=r),s?0<=t?s[t]=i:s.push(i):this.series.options.nodes=[i],d(o,!0)&&this.series.chart.redraw(e))}t=o=o||{};const m=[];t.compose=function(t,o){return e.pushUnique(m,t)&&((t=t.prototype).setNodeState=c,t.setState=c,t.update=u),e.pushUnique(m,o)&&((t=o.prototype).destroy=a,t.setData=p),o},t.createNode=function(t){const o=this.pointClass;var e=(t,o)=>r(t,t=>t.id===o);let i=e(this.nodes,t);if(!i){e=this.options.nodes&&e(this.options.nodes,t);const s=(new o).init(this,n({className:"highcharts-node",isNode:!0,id:t,y:1},e));s.linksTo=[],s.linksFrom=[],s.getSum=function(){let o=0,e=0;return s.linksTo.forEach(t=>{o+=t.weight||0}),s.linksFrom.forEach(t=>{e+=t.weight||0}),Math.max(o,e)},s.offset=function(o,e){let i=0;for(let t=0;t<s[e].length;t++){if(s[e][t]===o)return i;i+=s[e][t].weight}},s.hasShape=function(){let o=0;return s.linksTo.forEach(t=>{t.outgoing&&o++}),!s.linksTo.length||o!==s.linksTo.length},s.index=this.nodes.push(s)-1,i=s}return i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=d(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},t.destroy=a,t.generatePoints=function(){const o=this.chart,e={};i.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(t=>{t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(t=>{s(t.from)&&(e[t.from]||(e[t.from]=this.createNode(t.from)),e[t.from].linksFrom.push(t),t.fromNode=e[t.from],o.styledMode?t.colorIndex=d(t.options.colorIndex,e[t.from].colorIndex):t.color=t.options.color||e[t.from].color),s(t.to)&&(e[t.to]||(e[t.to]=this.createNode(t.to)),e[t.to].linksTo.push(t),t.toNode=e[t.to]),t.name=t.name||t.id},this),this.nodeLookup=e},t.setNodeState=c,t.updateNode=u}return o}),o(t,"Series/Sankey/SankeyPoint.js",[t["Core/Series/Point.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(e,t,o){({column:t}=t.seriesTypes);const i=o["defined"];class s extends t.prototype.pointClass{constructor(){super(...arguments),this.toNode=this.series=this.options=this.nodeY=this.nodeX=this.mass=this.linksTo=this.linksFrom=this.linkBase=this.level=this.fromNode=this.className=void 0}applyOptions(t,o){return e.prototype.applyOptions.call(this,t,o),i(this.options.level)&&(this.options.column=this.column=this.options.level),this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)}getFromNode(){let o=-1,e;for(let t=0;t<this.linksTo.length;t++){var i=this.linksTo[t];i.fromNode.column>o&&i.fromNode!==this&&(e=i.fromNode,o=e.column)}return{fromNode:e,fromColumn:o}}setNodeColumn(){i(this.options.column)||(this.column=0===this.linksTo.length?0:this.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"==typeof this.weight}}return s}),o(t,"Series/Sankey/SankeySeriesDefaults.js",[],function(){return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,opacity:1,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}}),o(t,"Series/Sankey/SankeyColumnComposition.js",[t["Core/Utilities.js"]],function(t){const{defined:p,relativeLength:c}=t;var o;{(t=o=o||{}).compose=function(t,o){return t.sankeyColumn=new e(t,o),t};class e{constructor(t,o){this.points=t,this.series=o}getTranslationFactor(t){const o=this.points,e=o.slice(),i=t.options.minLinkWidth||0;let s=0,n,r=(t.chart.plotSizeY||0)-(t.options.borderWidth||0)-(o.length-1)*t.nodePadding;for(;o.length;){for(s=r/o.sankeyColumn.sum(),t=!1,n=o.length;n--;)o[n].getSum()*s<i&&(o.splice(n,1),r-=i,t=!0);if(!t)break}return o.length=0,e.forEach(t=>{o.push(t)}),s}top(e){const i=this.series,s=i.nodePadding,t=this.points.reduce(function(t,o){return 0<t&&(t+=s),t+(o=Math.max(o.getSum()*e,i.options.minLinkWidth||0))},0);return((i.chart.plotSizeY||0)-t)/2}left(e){const i=this.series,t=i.chart,s=i.options.equalNodes,n=t.inverted?t.plotHeight:t.plotWidth,r=i.nodePadding,o=this.points.reduce(function(t,o){return 0<t&&(t+=r),t+(o=s?n/o.series.nodes.length-r:Math.max(o.getSum()*e,i.options.minLinkWidth||0))},0);return((t.plotSizeX||0)-Math.round(o))/2}sum(){return this.points.reduce(function(t,o){return t+o.getSum()},0)}offset(o,e){const i=this.points,s=this.series,n=s.nodePadding;let r=0;if(s.is("organization")&&o.hangsFrom)return{absoluteTop:o.hangsFrom.nodeY};for(let t=0;t<i.length;t++){var a=i[t].getSum(),l=Math.max(a*e,s.options.minLinkWidth||0),h=o.options[s.chart.inverted?"offsetHorizontal":"offsetVertical"],d=o.options.offset||0,a=a?l+n:0;if(i[t]===o)return{relativeTop:r+(p(h)?c(h,l):c(d,a))};r+=a}}}t.SankeyColumnAdditions=e}return o}),o(t,"Series/TreeUtilities.js",[t["Core/Color/Color.js"],t["Core/Utilities.js"]],function(f,t){const{extend:d,isArray:r,isNumber:a,isObject:l,merge:h,pick:g}=t;return{getColor:function(t,o){var e,i,s=o.index,n=o.mapOptionsToLevel,r=o.parentColor,a=o.parentColorIndex,l=o.series,h=o.colors,d=o.siblings,p=l.points,c=l.chart.options.chart;let u,m;return t&&(p=p[t.i],t=n[t.level]||{},p&&t.colorByPoint&&(u=p.index%(h?h.length:c.colorCount),i=h&&h[u]),l.chart.styledMode||(h=p&&p.options.color,c=t&&t.color,(e=r)&&(e=(e=t&&t.colorVariation)&&"brightness"===e.key&&s&&d?f.parse(r).brighten(s/d*e.to).get():r),e=g(h,c,i,e,l.color)),m=g(p&&p.options.colorIndex,t&&t.colorIndex,u,a,o.colorIndex)),{color:e,colorIndex:m}},getLevelOptions:function(t){let o={},s,e,n;if(l(t)){n=a(t.from)?t.from:1;var i=t.levels;for(e={},s=l(t.defaults)?t.defaults:{},r(i)&&(e=i.reduce((t,o)=>{let e,i;return l(o)&&a(o.level)&&(i=h({},o),e=g(i.levelIsConstant,s.levelIsConstant),delete i.levelIsConstant,delete i.level,o=o.level+(e?0:n-1),l(t[o])?h(!0,t[o],i):t[o]=i),t},{})),i=a(t.to)?t.to:1,t=0;t<=i;t++)o[t]=h({},s,l(e[t])?e[t]:{})}return o},setTreeValues:function i(s,n){var t=n.before;const o=n.idRoot,e=n.mapIdToNode[o],r=n.points[s.i],a=r&&r.options||{},l=[];let h=0;return s.levelDynamic=s.level-(!1!==n.levelIsConstant?0:e.level),s.name=g(r&&r.name,""),s.visible=o===s.id||!0===n.visible,(s="function"==typeof t?t(s,n):s).children.forEach((t,o)=>{var e=d({},n);d(e,{index:o,siblings:s.children.length,visible:s.visible}),t=i(t,e),l.push(t),t.visible&&(h+=t.val)}),t=g(a.value,h),s.visible=0<=t&&(0<h||s.visible),s.children=l,s.childrenTotal=h,s.isLeaf=s.visible&&!h,s.val=t,s},updateRootId:function(t){var o;return l(t)&&(o=l(t.options)?t.options:{},o=g(t.rootNode,o.rootId,""),l(t.userOptions)&&(t.userOptions.rootId=o),t.rootNode=o),o}}}),o(t,"Series/Sankey/SankeySeries.js",[t["Core/Color/Color.js"],t["Core/Globals.js"],t["Series/NodesComposition.js"],t["Series/Sankey/SankeyPoint.js"],t["Series/Sankey/SankeySeriesDefaults.js"],t["Core/Series/SeriesRegistry.js"],t["Series/Sankey/SankeyColumnComposition.js"],t["Series/TreeUtilities.js"],t["Core/Utilities.js"]],function(a,t,e,o,i,s,n,r,l){const{series:h,seriesTypes:{column:d}}=s,p=r["getLevelOptions"],{extend:c,isObject:u,merge:m,pick:f,relativeLength:g,stableSort:y}=l;class v extends d{constructor(){super(...arguments),this.translationFactor=this.points=this.options=this.nodeWidth=this.nodes=this.nodePadding=this.nodeLookup=this.group=this.data=this.colDistance=void 0}static getDLOptions(t){var o=u(t.optionsPoint)?t.optionsPoint.dataLabels:{};return t=u(t.level)?t.level.dataLabels:{},m({style:{}},t,o)}createNodeColumns(){const o=[];this.nodes.forEach(function(t){t.setNodeColumn(),o[t.column]||(o[t.column]=n.compose([],this)),o[t.column].push(t)},this);for(let t=0;t<o.length;t++)void 0===o[t]&&(o[t]=n.compose([],this));return o}order(t,o){const e=this;void 0===t.level&&(t.level=o,t.linksFrom.forEach(function(t){t.toNode&&e.order(t.toNode,o+1)}))}generatePoints(){e.generatePoints.apply(this,arguments);const o=this;this.orderNodes&&(this.nodes.filter(function(t){return 0===t.linksTo.length}).forEach(function(t){o.order(t,0)}),y(this.nodes,function(t,o){return t.level-o.level}))}getNodePadding(){let t=this.options.nodePadding||0;var o;return t=this.nodeColumns&&(o=this.nodeColumns.reduce((t,o)=>Math.max(t,o.length),0))*t>this.chart.plotSizeY?this.chart.plotSizeY/o:t}hasData(){return!!this.processedXData.length}pointAttribs(t,o){if(!t)return{};const e=this,i=e.mapOptionsToLevel[(t.isNode?t:t.fromNode).level||0]||{},s=t.options,n=i.states&&i.states[o||""]||{};o=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce(function(t,o){return t[o]=f(n[o],s[o],i[o],e.options[o]),t},{});var r=f(n.color,s.color,(o.colorByPoint?t:i).color);return t.isNode?{fill:r,stroke:o.borderColor,"stroke-width":o.borderWidth,opacity:o.opacity}:{fill:a.parse(r).setOpacity(o.linkOpacity).get()}}drawTracker(){d.prototype.drawTracker.call(this,this.points),d.prototype.drawTracker.call(this,this.nodes)}drawPoints(){d.prototype.drawPoints.call(this,this.points),d.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){d.prototype.drawDataLabels.call(this,this.points),d.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);const e=this,t=this.chart,o=this.options,i=this.nodeWidth,s=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=s.reduce((t,o)=>Math.min(t,o.sankeyColumn.getTranslationFactor(e)),1/0),this.colDistance=(t.plotSizeX-i-o.borderWidth)/Math.max(1,s.length-1),e.mapOptionsToLevel=p({from:1,levels:o.levels,to:s.length-1,defaults:{borderColor:o.borderColor,borderRadius:o.borderRadius,borderWidth:o.borderWidth,color:e.color,colorByPoint:o.colorByPoint,levelIsConstant:!0,linkColor:o.linkColor,linkLineWidth:o.linkLineWidth,linkOpacity:o.linkOpacity,states:o.states}}),s.forEach(function(o){o.forEach(function(t){e.translateNode(t,o)})},this),this.nodes.forEach(function(t){t.linksFrom.forEach(function(t){(t.weight||t.isNull)&&t.to&&(e.translateLink(t),t.allowShadow=!1)})})}translateLink(e){var t=(t,o)=>(o=t.offset(e,o)*n,Math.min(t.nodeY+o,t.nodeY+(t.shapeArgs&&t.shapeArgs.height||0)-r));let o=e.fromNode;var i=e.toNode;let s=this.chart,n=this.translationFactor,r=Math.max(e.weight*n,this.options.minLinkWidth);var a=(s.inverted?-this.colDistance:this.colDistance)*this.options.curveFactor;let l=t(o,"linksFrom"),h=(t=t(i,"linksTo"),o.nodeX),d=this.nodeWidth;var i=i.nodeX,p=e.outgoing,c=i>h+d;if(s.inverted&&(l=s.plotSizeY-l,t=(s.plotSizeY||0)-t,d=-d,r=-r,c=i<h),e.shapeType="path",e.linkBase=[l,l+r,t,t+r],c&&"number"==typeof t)e.shapeArgs={d:[["M",h+d,l],["C",h+d+a,l,i-a,t,i,t],["L",i+(p?d:0),t+r/2],["L",i,t+r],["C",i-a,t+r,h+d+a,l+r,h+d,l+r],["Z"]]};else if("number"==typeof t){a=i-20-r,p=i-20;const o=(c=h+d)+20,n=o+r,u=l,m=l+r,f=m+20,g=f+(s.plotHeight-l-r),y=g+20,v=y+r,k=t,C=k+r,S=C+20,N=y+.7*r,b=i-.7*r,L=c+.7*r;e.shapeArgs={d:[["M",c,u],["C",L,u,n,m-.7*r,n,f],["L",n,g],["C",n,N,L,v,c,v],["L",i,v],["C",b,v,a,N,a,g],["L",a,S],["C",a,C-.7*r,b,k,i,k],["L",i,C],["C",p,C,p,C,p,S],["L",p,g],["C",p,y,p,y,i,y],["L",c,y],["C",o,y,o,y,o,g],["L",o,f],["C",o,m,o,m,c,m],["Z"]]}}e.dlBox={x:h+(i-h+d)/2,y:l+(t-l)/2,height:r,width:0},e.tooltipPos=s.inverted?[s.plotSizeY-e.dlBox.y-r/2,s.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+r/2],e.y=e.plotY=1,e.x=e.plotX=1,e.color||(e.color=o.color)}translateNode(o,e){var i=this.translationFactor,s=this.chart,n=this.options,{borderRadius:r,borderWidth:a=0}=n,l=o.getSum(),h=Math.max(Math.round(l*i),this.options.minLinkWidth),d=Math.round(this.nodeWidth),p=Math.round(a)%2/2,c=e.sankeyColumn.offset(o,i);if(e=Math.floor(f(c.absoluteTop,e.sankeyColumn.top(i)+c.relativeTop))+p,p=Math.floor(this.colDistance*o.column+a/2)+g(o.options.offsetHorizontal||0,d)+p,p=s.inverted?s.plotSizeX-p:p,o.sum=l){o.shapeType="roundedRect",l=o.nodeX=p,i=o.nodeY=e,c=o.options.width||n.width||d;let t=o.options.height||n.height||h;a=g("object"==typeof r?r.radius:r||0,c);s.inverted&&(l=p-d,i=s.plotSizeY-e-h,c=o.options.height||n.height||d,t=o.options.width||n.width||h),o.dlOptions=v.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=s.inverted?[s.plotSizeY-i-t/2,s.plotSizeX-l-c/2]:[l+c/2,i+t/2],o.shapeArgs={x:l,y:i,width:c,height:t,r:a,display:o.hasShape()?"":"none"}}else o.dlOptions={enabled:!1}}}return v.defaultOptions=m(d.defaultOptions,i),e.compose(o,v),c(v.prototype,{animate:h.prototype.animate,createNode:e.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:o,searchPoint:t.noop}),s.registerSeriesType("sankey",v),v}),o(t,"masters/modules/sankey.src.js",[],function(){})});