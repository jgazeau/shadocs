!function(o){"object"==typeof module&&module.exports?module.exports=o.default=o:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(t){return o(t),o.Highcharts=t,o}):o("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){"use strict";t=t?t._modules:{};function o(t,o,e,i){t.hasOwnProperty(o)||(t[o]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:o,module:t[o]}})))}o(t,"Series/NodesComposition.js",[t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(o,i){var e;let{prototype:s,prototype:{pointClass:{prototype:a}}}=o["series"],{defined:n,extend:r,find:l,merge:d,pick:h}=i;{o=e=e||{};let t=[];function p(){return this.data=[].concat(this.points||[],this.nodes),s.destroy.apply(this,arguments)}function c(){this.nodes&&(this.nodes.forEach(t=>{t.destroy()}),this.nodes.length=0),s.setData.apply(this,arguments)}function u(t){let o=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&e.forEach(t=>{t&&t.series&&(a.setState.apply(t,o),t.isNode||(t.fromNode.graphic&&a.setState.apply(t.fromNode,o),t.toNode&&t.toNode.graphic&&a.setState.apply(t.toNode,o)))}),a.setState.apply(this,o)}function m(t,o,e,i){let s=this.series.options.nodes,n=this.series.options.data,r=n&&n.length||0,l=n&&n[this.index];a.update.call(this,t,!this.isNode&&o,e,i),this.isNode&&(t=(s||[]).reduce((t,o,e)=>this.id===o.id?e:t,-1),i=d(s&&s[t]||{},n&&n[this.index]||{}),n&&(l?n[this.index]=l:n.length=r),s?0<=t?s[t]=i:s.push(i):this.series.options.nodes=[i],h(o,!0)&&this.series.chart.redraw(e))}o.compose=function(o,e){if(i.pushUnique(t,o)){let t=o.prototype;t.setNodeState=u,t.setState=u,t.update=m}if(i.pushUnique(t,e)){let t=e.prototype;t.destroy=p,t.setData=c}return e},o.createNode=function(t){let o=this.pointClass,e=(t,o)=>l(t,t=>t.id===o),i=e(this.nodes,t),n;if(!i){n=this.options.nodes&&e(this.options.nodes,t);let s=(new o).init(this,r({className:"highcharts-node",isNode:!0,id:t,y:1},n));s.linksTo=[],s.linksFrom=[],s.getSum=function(){let o=0,e=0;return s.linksTo.forEach(t=>{o+=t.weight||0}),s.linksFrom.forEach(t=>{e+=t.weight||0}),Math.max(o,e)},s.offset=function(o,e){let i=0;for(let t=0;t<s[e].length;t++){if(s[e][t]===o)return i;i+=s[e][t].weight}},s.hasShape=function(){let o=0;return s.linksTo.forEach(t=>{t.outgoing&&o++}),!s.linksTo.length||o!==s.linksTo.length},s.index=this.nodes.push(s)-1,i=s}return i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=h(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},o.destroy=p,o.generatePoints=function(){let o=this.chart,e={};s.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(t=>{t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(t=>{n(t.from)&&(e[t.from]||(e[t.from]=this.createNode(t.from)),e[t.from].linksFrom.push(t),t.fromNode=e[t.from],o.styledMode?t.colorIndex=h(t.options.colorIndex,e[t.from].colorIndex):t.color=t.options.color||e[t.from].color),n(t.to)&&(e[t.to]||(e[t.to]=this.createNode(t.to)),e[t.to].linksTo.push(t),t.toNode=e[t.to]),t.name=t.name||t.id},this),this.nodeLookup=e},o.setNodeState=u,o.updateNode=m}return e}),o(t,"Series/Sankey/SankeyPoint.js",[t["Core/Series/Point.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(e,t,o){let i=t.seriesTypes["column"],s=o["defined"];class n extends i.prototype.pointClass{constructor(){super(...arguments),this.className=void 0,this.fromNode=void 0,this.level=void 0,this.linkBase=void 0,this.linkColorMode=void 0,this.linksFrom=void 0,this.linksTo=void 0,this.mass=void 0,this.nodeX=void 0,this.nodeY=void 0,this.options=void 0,this.series=void 0,this.toNode=void 0}applyOptions(t,o){return e.prototype.applyOptions.call(this,t,o),s(this.options.level)&&(this.options.column=this.column=this.options.level),this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)}getFromNode(){let o=-1,e;for(let t=0;t<this.linksTo.length;t++){var i=this.linksTo[t];i.fromNode.column>o&&i.fromNode!==this&&(o=(e=i.fromNode).column)}return{fromNode:e,fromColumn:o}}setNodeColumn(){s(this.options.column)||(0===this.linksTo.length?this.column=0:this.column=this.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"==typeof this.weight}}return n}),o(t,"Series/Sankey/SankeySeriesDefaults.js",[],function(){return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}}),o(t,"Series/Sankey/SankeyColumnComposition.js",[t["Core/Utilities.js"]],function(t){var o;let{defined:c,relativeLength:u}=t;{(t=o=o||{}).compose=function(t,o){return t.sankeyColumn=new e(t,o),t};class e{constructor(t,o){this.points=t,this.series=o}getTranslationFactor(t){let o=this.points,e=o.slice(),i=t.chart,s=t.options.minLinkWidth||0,n,r=0,l,a=(i.plotSizeY||0)-(t.options.borderWidth||0)-(o.length-1)*t.nodePadding;for(;o.length;){for(r=a/o.sankeyColumn.sum(),n=!1,l=o.length;l--;)o[l].getSum()*r<s&&(o.splice(l,1),a=Math.max(0,a-s),n=!0);if(!n)break}for(var d of(o.length=0,e))o.push(d);return r}top(e){let i=this.series,s=i.nodePadding,t=this.points.reduce((t,o)=>{return 0<t&&(t+=s),t+Math.max(o.getSum()*e,i.options.minLinkWidth||0)},0);return{top:0,center:.5,bottom:1}[i.options.nodeAlignment||"center"]*((i.chart.plotSizeY||0)-t)}left(e){let i=this.series,t=i.chart,s=i.options.equalNodes,n=t.inverted?t.plotHeight:t.plotWidth,r=i.nodePadding,o=this.points.reduce((t,o)=>{return 0<t&&(t+=r),t+(s?n/o.series.nodes.length-r:Math.max(o.getSum()*e,i.options.minLinkWidth||0))},0);return((t.plotSizeX||0)-Math.round(o))/2}sum(){return this.points.reduce((t,o)=>t+o.getSum(),0)}offset(o,e){let i=this.points,s=this.series,n=s.nodePadding,r=0,l;if(s.is("organization")&&o.hangsFrom)return{absoluteTop:o.hangsFrom.nodeY};for(let t=0;t<i.length;t++){var a=i[t].getSum(),d=Math.max(a*e,s.options.minLinkWidth||0),h=o.options[s.chart.inverted?"offsetHorizontal":"offsetVertical"],p=o.options.offset||0;if(l=a?d+n:0,i[t]===o)return{relativeTop:r+(c(h)?u(h,d):u(p,l))};r+=l}}}t.SankeyColumnAdditions=e}return o}),o(t,"Series/TreeUtilities.js",[t["Core/Color/Color.js"],t["Core/Utilities.js"]],function(y,t){let{extend:m,isArray:a,isNumber:d,isObject:h,merge:p,pick:k}=t;return{getColor:function(t,o){let e,i,s,n,r,l,a=o.index,d=o.mapOptionsToLevel,h=o.parentColor,p=o.parentColorIndex,c=o.series,u=o.colors,m=o.siblings,f=c.points,g=c.chart.options.chart;return t&&(e=f[t.i],i=d[t.level]||{},e&&i.colorByPoint&&(n=e.index%(u?u.length:g.colorCount),s=u&&u[n]),c.chart.styledMode||(r=k(e&&e.options.color,i&&i.color,s,h&&(t=h,(v=i&&i.colorVariation)&&"brightness"===v.key&&a&&m?y.parse(t).brighten(v.to*(a/m)).get():t),c.color)),l=k(e&&e.options.colorIndex,i&&i.colorIndex,n,p,o.colorIndex)),{color:r,colorIndex:l};var v},getLevelOptions:function(t){let o={},n,e,i,r,s,l;if(h(t))for(r=d(t.from)?t.from:1,l=t.levels,e={},n=h(t.defaults)?t.defaults:{},a(l)&&(e=l.reduce((t,o)=>{let e,i,s;return h(o)&&d(o.level)&&(i=k((s=p({},o)).levelIsConstant,n.levelIsConstant),delete s.levelIsConstant,delete s.level,h(t[e=o.level+(i?0:r-1)])?p(!0,t[e],s):t[e]=s),t},{})),s=d(t.to)?t.to:1,i=0;i<=s;i++)o[i]=p({},n,h(e[i])?e[i]:{});return o},setTreeValues:function i(s,n){let t=n.before,o=n.idRoot,e=n.mapIdToNode,r=e[o],l=!1!==n.levelIsConstant,a=n.points,d=a[s.i],h=d&&d.options||{},p=[],c=0;s.levelDynamic=s.level-(l?0:r.level),s.name=k(d&&d.name,""),s.visible=o===s.id||!0===n.visible,(s="function"==typeof t?t(s,n):s).children.forEach((t,o)=>{var e=m({},n);m(e,{index:o,siblings:s.children.length,visible:s.visible}),t=i(t,e),p.push(t),t.visible&&(c+=t.val)});var u=k(h.value,c);return s.visible=0<=u&&(0<c||s.visible),s.children=p,s.childrenTotal=c,s.isLeaf=s.visible&&!c,s.val=u,s},updateRootId:function(t){let o,e;return h(t)&&(e=h(t.options)?t.options:{},o=k(t.rootNode,e.rootId,""),h(t.userOptions)&&(t.userOptions.rootId=o),t.rootNode=o),o}}}),o(t,"Series/Sankey/SankeySeries.js",[t["Core/Globals.js"],t["Series/NodesComposition.js"],t["Series/Sankey/SankeyPoint.js"],t["Series/Sankey/SankeySeriesDefaults.js"],t["Core/Series/SeriesRegistry.js"],t["Series/Sankey/SankeyColumnComposition.js"],t["Core/Color/Color.js"],t["Series/TreeUtilities.js"],t["Core/Utilities.js"]],function(t,o,e,i,s,n,d,r,l){let{column:a,line:h}=s.seriesTypes,Y=d["parse"],p=r["getLevelOptions"],{clamp:u,extend:c,isObject:m,merge:f,pick:X,relativeLength:g,stableSort:v}=l;class y extends a{constructor(){super(...arguments),this.colDistance=void 0,this.data=void 0,this.group=void 0,this.nodeLookup=void 0,this.nodePadding=void 0,this.nodes=void 0,this.nodeWidth=void 0,this.options=void 0,this.points=void 0,this.translationFactor=void 0}static getDLOptions(t){var o=m(t.optionsPoint)?t.optionsPoint.dataLabels:{},t=m(t.level)?t.level.dataLabels:{};return f({style:{}},t,o)}createNodeColumns(){let o=[];for(var t of this.nodes)t.setNodeColumn(),o[t.column]||(o[t.column]=n.compose([],this)),o[t.column].push(t);for(let t=0;t<o.length;t++)void 0===o[t]&&(o[t]=n.compose([],this));return o}order(t,o){if(void 0===t.level)for(var e of(t.level=o,t.linksFrom))e.toNode&&this.order(e.toNode,o+1)}generatePoints(){if(o.generatePoints.apply(this,arguments),this.orderNodes){for(var t of this.nodes)0===t.linksTo.length&&this.order(t,0);v(this.nodes,(t,o)=>t.level-o.level)}}getNodePadding(){let t=this.options.nodePadding||0;var o;return t=this.nodeColumns&&(o=this.nodeColumns.reduce((t,o)=>Math.max(t,o.length),0))*t>this.chart.plotSizeY?this.chart.plotSizeY/o:t}hasData(){return!!this.processedXData.length}pointAttribs(t,o){if(!t)return{};let e=this,i=(t.isNode?t:t.fromNode).level,s=e.mapOptionsToLevel[i||0]||{},n=t.options,r=s.states&&s.states[o||""]||{},l=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce((t,o)=>(t[o]=X(r[o],n[o],s[o],e.options[o]),t),{}),a=X(r.color,n.color,(l.colorByPoint?t:s).color);return t.isNode?{fill:a,stroke:l.borderColor,"stroke-width":l.borderWidth,opacity:l.opacity}:{fill:d.parse(a).setOpacity(l.linkOpacity).get()}}drawTracker(){a.prototype.drawTracker.call(this,this.points),a.prototype.drawTracker.call(this,this.nodes)}drawPoints(){a.prototype.drawPoints.call(this,this.points),a.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){a.prototype.drawDataLabels.call(this,this.points),a.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);let e=this,t=this.chart,o=this.options,i=this.nodeWidth,s=this.nodeColumns;for(var n of(this.nodePadding=this.getNodePadding(),this.translationFactor=s.reduce((t,o)=>Math.min(t,o.sankeyColumn.getTranslationFactor(e)),1/0),this.colDistance=(t.plotSizeX-i-o.borderWidth)/Math.max(1,s.length-1),e.mapOptionsToLevel=p({from:1,levels:o.levels,to:s.length-1,defaults:{borderColor:o.borderColor,borderRadius:o.borderRadius,borderWidth:o.borderWidth,color:e.color,colorByPoint:o.colorByPoint,levelIsConstant:!0,linkColor:o.linkColor,linkLineWidth:o.linkLineWidth,linkOpacity:o.linkOpacity,states:o.states}}),s))for(var r of n)e.translateNode(r,n);for(var l of this.nodes)for(var a of l.linksFrom)(a.weight||a.isNull)&&a.to&&(e.translateLink(a),a.allowShadow=!1)}translateLink(e){let t=(t,o)=>{o=t.offset(e,o)*r;return Math.min(t.nodeY+o,t.nodeY+(t.shapeArgs&&t.shapeArgs.height||0)-c)},o=e.fromNode,i=e.toNode,s=this.chart,n=s["inverted"],r=this.translationFactor,l=this.options,a=X(e.linkColorMode,l.linkColorMode),d=(s.inverted?-this.colDistance:this.colDistance)*l.curveFactor,h=o.nodeX,p=i.nodeX,I=e.outgoing,c=Math.max(e.weight*r,this.options.minLinkWidth),u=t(o,"linksFrom"),m=t(i,"linksTo"),f=this.nodeWidth,g=p>h+f;var v,y,k,C,S,N,b,x,L,T,P,w,j,O,M,F,W,D,z;s.inverted&&(u=s.plotSizeY-u,m=(s.plotSizeY||0)-m,f=-f,c=-c,g=p<h),e.shapeType="path",e.linkBase=[u,u+c,m,m+c],g&&"number"==typeof m?e.shapeArgs={d:[["M",h+f,u],["C",h+f+d,u,p-d,m,p,m],["L",p+(I?f:0),m+c/2],["L",p,m+c],["C",p-d,m+c,h+f+d,u+c,h+f,u+c],["Z"]]}:"number"==typeof m&&(x=s.plotHeight-u-c,v=p-20-c,y=p-20,S=(C=(k=h+f)+20)+c,T=(L=(x=(b=(N=(D=u)+c)+20)+x)+20)+c,j=(w=(P=m)+c)+20,z=N-.7*c,O=L+.7*c,M=w-.7*c,F=p-.7*c,W=k+.7*c,e.shapeArgs={d:[["M",k,D],["C",W,D,S,z,S,b],["L",S,x],["C",S,O,W,T,k,T],["L",p,T],["C",F,T,v,O,v,x],["L",v,j],["C",v,M,F,P,p,P],["L",p,w],["C",y,w,y,w,y,j],["L",y,x],["C",y,L,y,L,p,L],["L",k,L],["C",C,L,C,L,C,x],["L",C,b],["C",C,N,C,N,k,N],["Z"]]}),e.dlBox={x:h+(p-h+f)/2,y:u+(m-u)/2,height:c,width:0},e.tooltipPos=s.inverted?[s.plotSizeY-e.dlBox.y-c/2,s.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+c/2],e.y=e.plotY=1,e.x=e.plotX=1,e.options.color||("from"===a?e.color=o.color:"to"===a?e.color=i.color:"gradient"===a&&(D=Y(o.color).get(),z=Y(i.color).get(),e.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,n?D:z],[1,n?z:D]]}))}translateNode(n,r){var t=this.translationFactor,l=this.chart,a=this.options,{borderRadius:d,borderWidth:o=0}=a,e=n.getSum(),h=Math.max(Math.round(e*t),this.options.minLinkWidth),p=Math.round(this.nodeWidth),i=Math.round(o)%2/2,c=r.sankeyColumn.offset(n,t),r=Math.floor(X(c.absoluteTop,r.sankeyColumn.top(t)+c.relativeTop))+i,t=Math.floor(this.colDistance*n.column+o/2)+g(n.options[l.inverted?"offsetVertical":"offsetHorizontal"]||0,p)+i,c=l.inverted?l.plotSizeX-t:t;if(n.sum=e){n.shapeType="roundedRect";let t=n.nodeX=c,o=n.nodeY=r,e=n.options.width||a.width||p,i=n.options.height||a.height||h,s=u(g("object"==typeof d?d.radius:d||0,e),0,h/2);l.inverted&&(t=c-p,o=l.plotSizeY-r-h,e=n.options.height||a.height||p,i=n.options.width||a.width||h),n.dlOptions=y.getDLOptions({level:this.mapOptionsToLevel[n.level],optionsPoint:n.options}),n.plotX=1,n.plotY=1,n.tooltipPos=l.inverted?[l.plotSizeY-o-i/2,l.plotSizeX-t-e/2]:[t+e/2,o+i/2],n.shapeArgs={x:t,y:o,width:e,height:i,r:s,display:n.hasShape()?"":"none"}}else n.dlOptions={enabled:!1}}}return y.defaultOptions=f(a.defaultOptions,i),o.compose(e,y),c(y.prototype,{animate:h.prototype.animate,createNode:o.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:e,searchPoint:t.noop}),s.registerSeriesType("sankey",y),y}),o(t,"masters/modules/sankey.src.js",[],function(){})});