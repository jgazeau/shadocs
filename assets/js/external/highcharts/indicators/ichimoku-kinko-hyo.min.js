"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/ichimoku-kinko-hyo",["highcharts","highcharts/modules/stock"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){function t(o,t,n,e){o.hasOwnProperty(t)||(o[t]=e.apply(null,n),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:o[t]}})))}t(o=o?o._modules:{},"Stock/Indicators/IKH/IKHIndicator.js",[o["Extensions/DataGrouping/ApproximationRegistry.js"],o["Core/Color/Color.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(i,o,C,t){function k(o){return{high:o.reduce(function(o,t){return Math.max(o,t[1])},-1/0),low:o.reduce(function(o,t){return Math.min(o,t[2])},1/0)}}function A(o){const t=o.indicator;t.points=o.points,t.nextPoints=o.nextPoints,t.color=o.color,t.options=Y(o.options.senkouSpan.styles,o.gap),t.graph=o.graph,t.fillGraph=!0,C.seriesTypes.sma.prototype.drawGraph.call(t)}const n=o["parse"],{defined:x,extend:e,isArray:S,isNumber:s,merge:Y,objectEach:P}=(o=C.seriesTypes["sma"],t);class p extends o{constructor(){super(...arguments),this.data=[],this.options={},this.points=[],this.graphCollection=[]}init(){super.init.apply(this,arguments),this.options=Y({tenkanLine:{styles:{lineColor:this.color}},kijunLine:{styles:{lineColor:this.color}},chikouLine:{styles:{lineColor:this.color}},senkouSpanA:{styles:{lineColor:this.color,fill:n(this.color).setOpacity(.5).get()}},senkouSpanB:{styles:{lineColor:this.color,fill:n(this.color).setOpacity(.5).get()}},senkouSpan:{styles:{fill:n(this.color).setOpacity(.2).get()}}},this.options)}toYData(o){return[o.tenkanSen,o.kijunSen,o.chikouSpan,o.senkouSpanA,o.senkouSpanB]}translate(){C.seriesTypes.sma.prototype.translate.apply(this);for(const t of this.points)for(const n of this.pointArrayMap){var o=t[n];s(o)&&(t["plot"+n]=this.yAxis.toPixels(o,!0),t.plotY=t["plot"+n],t.tooltipPos=[t.plotX,t["plot"+n]],t.isNull=!1)}}drawGraph(){const n=this,o=n.points,e=n.options,t=n.graph,i=n.color,s={options:{gapSize:e.gapSize}};var p=n.pointArrayMap.length;const a=[[],[],[],[],[],[]],l={tenkanLine:a[0],kijunLine:a[1],chikouLine:a[2],senkouSpanA:a[3],senkouSpanB:a[4],senkouSpan:a[5]},r=[];var h,u=n.options.senkouSpan;const c=u.color||u.styles.fill,d=u.negativeColor,f=[[],[]],g=[[],[]];u=o.length;let k=0,S;for(n.ikhMap=l;u--;){for(var y=o[u],m=0;m<p;m++){var v=n.pointArrayMap[m];x(y[v])&&a[m].push({plotX:y.plotX,plotY:y["plot"+v],isNull:!1})}d&&u!==o.length-1&&(v=l.senkouSpanB.length-1,y=function(o,t,n,e){if(o&&t&&n&&e){var i=t.plotX-o.plotX,s=(t=t.plotY-o.plotY,e.plotX-n.plotX),p=(e=e.plotY-n.plotY,o.plotX-n.plotX),a=o.plotY-n.plotY;if(n=(-t*p+i*a)/(-s*t+i*e),s=(s*a-e*p)/(-s*t+i*e),0<=n&&n<=1&&0<=s&&s<=1)return{plotX:o.plotX+s*i,plotY:o.plotY+s*t}}}(l.senkouSpanA[v-1],l.senkouSpanA[v],l.senkouSpanB[v-1],l.senkouSpanB[v]))&&(y={plotX:y.plotX,plotY:y.plotY,isNull:!1,intersectPoint:!0},l.senkouSpanA.splice(v,0,y),l.senkouSpanB.splice(v,0,y),r.push(v))}if(P(l,(o,t)=>{e[t]&&"senkouSpan"!==t&&(n.points=a[k],n.options=Y(e[t].styles,s),n.graph=n["graph"+t],n.fillGraph=!1,n.color=i,C.seriesTypes.sma.prototype.drawGraph.call(n),n["graph"+t]=n.graph),k++}),n.graphCollection)for(h of n.graphCollection)n[h].destroy(),delete n[h];if(n.graphCollection=[],d&&l.senkouSpanA[0]&&l.senkouSpanB[0]){for(r.unshift(0),r.push(l.senkouSpanA.length-1),h=0;h<r.length-1;h++){if(u=r[h],v=r[h+1],p=l.senkouSpanB.slice(u,v+1),u=l.senkouSpanA.slice(u,v+1),1<=Math.floor(p.length/2))if(p[v=Math.floor(p.length/2)].plotY===u[v].plotY){for(m=y=v=0;m<p.length;m++)v+=p[m].plotY,y+=u[m].plotY;v=y<v?0:1}else v=p[v].plotY>u[v].plotY?0:1;else v=p[0].plotY>u[0].plotY?0:1;f[v]=f[v].concat(p),g[v]=g[v].concat(u)}["graphsenkouSpanColor","graphsenkouSpanNegativeColor"].forEach(function(o,t){f[t].length&&g[t].length&&(S=0===t?c:d,A({indicator:n,points:f[t],nextPoints:g[t],color:S,options:e,gap:s,graph:n[o]}),n[o]=n.graph,n.graphCollection.push(o))})}else A({indicator:n,points:l.senkouSpanB,nextPoints:l.senkouSpanA,color:c,options:e,gap:s,graph:n.graphsenkouSpan}),n.graphsenkouSpan=n.graph;delete n.nextPoints,delete n.fillGraph,n.points=o,n.options=e,n.graph=t,n.color=i}getGraphPath(o){let t=[];var n;if(o=o||this.points,this.fillGraph&&this.nextPoints){if((n=C.seriesTypes.sma.prototype.getGraphPath.call(this,this.nextPoints))&&n.length){n[0][0]="L",t=C.seriesTypes.sma.prototype.getGraphPath.call(this,o);for(let o=(n=n.slice(0,t.length)).length-1;0<=o;o--)t.push(n[o])}}else t=C.seriesTypes.sma.prototype.getGraphPath.apply(this,arguments);return t}getValues(o,t){var n=t.period,e=t.periodTenkan;t=t.periodSenkouSpanB;const i=o.xData,s=o.yData,p=s&&s.length||0,a=(o=function(o){let t,n,e,i,s;return o.series.forEach(function(o){if(o.xData)for(i=o.xData,s=n=o.xIncrement?1:i.length-1;0<s;s--)e=i[s]-i[s-1],(void 0===t||e<t)&&(t=e)}),t}(o.xAxis),[]),l=[];let r,h,u;if(!(i.length<=n)&&S(s[0])&&4===s[0].length){var c,d,f,g=i[0]-n*o;for(h=0;h<n;h++)l.push(g+h*o);for(h=0;h<p;h++)h>=e&&(c=((c=k(c=s.slice(h-e,h))).high+c.low)/2),h>=n&&(d=((d=k(d=s.slice(h-n,h))).high+d.low)/2,u=(c+d)/2),h>=t&&(f=((f=k(f=s.slice(h-t,h))).high+f.low)/2),g=s[h][3],r=i[h],void 0===a[h]&&(a[h]=[]),void 0===a[h+n-1]&&(a[h+n-1]=[]),a[h+n-1][0]=c,a[h+n-1][1]=d,(a[h+n-1][2]=void 0)===a[h+1]&&(a[h+1]=[]),a[h+1][2]=g,h<=n&&(a[h+n-1][3]=void 0,a[h+n-1][4]=void 0),void 0===a[h+2*n-2]&&(a[h+2*n-2]=[]),a[h+2*n-2][3]=u,a[h+2*n-2][4]=f,l.push(r);for(h=1;h<=n;h++)l.push(r+h*o);return{values:a,xData:l,yData:a}}}}return p.defaultOptions=Y(o.defaultOptions,{params:{index:void 0,period:26,periodTenkan:9,periodSenkouSpanB:52},marker:{enabled:!1},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> <b> {series.name}</b><br/>TENKAN SEN: {point.tenkanSen:.3f}<br/>KIJUN SEN: {point.kijunSen:.3f}<br/>CHIKOU SPAN: {point.chikouSpan:.3f}<br/>SENKOU SPAN A: {point.senkouSpanA:.3f}<br/>SENKOU SPAN B: {point.senkouSpanB:.3f}<br/>'},tenkanLine:{styles:{lineWidth:1,lineColor:void 0}},kijunLine:{styles:{lineWidth:1,lineColor:void 0}},chikouLine:{styles:{lineWidth:1,lineColor:void 0}},senkouSpanA:{styles:{lineWidth:1,lineColor:void 0}},senkouSpanB:{styles:{lineWidth:1,lineColor:void 0}},senkouSpan:{styles:{fill:"rgba(255, 0, 0, 0.5)"}},dataGrouping:{approximation:"ichimoku-averages"}}),e(p.prototype,{pointArrayMap:["tenkanSen","kijunSen","chikouSpan","senkouSpanA","senkouSpanB"],pointValKey:"tenkanSen",nameComponents:["periodSenkouSpanB","period","periodTenkan"]}),i["ichimoku-averages"]=function(){const n=[];let e;return[].forEach.call(arguments,function(o,t){n.push(i.average(o)),e=!e&&void 0===n[t]}),e?void 0:n},C.registerSeriesType("ikh",p),p}),t(o,"masters/indicators/ichimoku-kinko-hyo.src.js",[],function(){})});