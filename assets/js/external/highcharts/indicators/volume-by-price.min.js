"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){function t(e,t,s,o){e.hasOwnProperty(t)||(e[t]=o.apply(null,s),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:e[t]}})))}t(e=e?e._modules:{},"Stock/Indicators/VBP/VBPPoint.js",[e["Core/Series/SeriesRegistry.js"]],function(e){({prototype:{pointClass:e}}=e.seriesTypes.sma);class t extends e{destroy(){this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),super.destroy.apply(this,arguments)}}return t}),t(e,"Stock/Indicators/VBP/VBPIndicator.js",[e["Stock/Indicators/VBP/VBPPoint.js"],e["Core/Animation/AnimationUtilities.js"],e["Core/Globals.js"],e["Core/Series/SeriesRegistry.js"],e["Core/Utilities.js"],e["Core/Chart/StockChart.js"]],function(e,t,s,o,i,a){const n=t["animObject"],{column:{prototype:y},sma:r}=(t=s["noop"],o.seriesTypes),{addEvent:l,arrayMax:S,arrayMin:u,correctFloat:V,defined:c,error:p,extend:h,isArray:d,merge:m}=i,D=Math.abs;class g extends r{constructor(){super(...arguments),this.zoneLinesSVG=this.zoneStarts=this.volumeDataArray=this.rangeStep=this.priceZones=this.posWidths=this.points=this.options=this.negWidths=this.data=void 0}init(t){const s=this,o=(super.init.apply(s,arguments),l(a,"afterLinkSeries",function(){if(s.options){const o=s.linkedParent,e=t.get(s.options.params.volumeSeriesID);s.addCustomEvents(o,e)}o()},{order:1}));return s}addCustomEvents(e,t){const s=this,o=()=>{s.chart.redraw(),s.setData([]),s.zoneStarts=[],s.zoneLinesSVG&&(s.zoneLinesSVG=s.zoneLinesSVG.destroy())};return s.dataEventsToUnbind.push(l(e,"remove",function(){o()})),t&&s.dataEventsToUnbind.push(l(t,"remove",function(){o()})),s}animate(e){const s=this,t=s.chart.inverted,o=s.group,i={};!e&&o&&(e=t?s.yAxis.top:s.xAxis.left,t?(o["forceAnimate:translateY"]=!0,i.translateY=e):(o["forceAnimate:translateX"]=!0,i.translateX=e),o.animate(i,h(n(s.options.animation),{step:function(e,t){s.group.attr({scaleX:Math.max(.001,t.pos)})}})))}drawPoints(){this.options.volumeDivision.enabled&&(this.posNegVolume(!0,!0),y.drawPoints.apply(this,arguments),this.posNegVolume(!1,!1)),y.drawPoints.apply(this,arguments)}posNegVolume(e,t){var s=t?["positive","negative"]:["negative","positive"],o=this.options.volumeDivision,i=this.points.length;let a=[],n=[],r=0,l,h,p,d;for(e?(this.posWidths=a,this.negWidths=n):(a=this.posWidths,n=this.negWidths);r<i;r++)(d=this.points[r])[s[0]+"Graphic"]=d.graphic,d.graphic=d[s[1]+"Graphic"],e&&(l=d.shapeArgs.width,(p=(h=this.priceZones[r]).wholeVolumeData)?(a.push(l/p*h.positiveVolumeData),n.push(l/p*h.negativeVolumeData)):(a.push(0),n.push(0))),d.color=t?o.styles.positiveColor:o.styles.negativeColor,d.shapeArgs.width=(t?this.posWidths:this.negWidths)[r],d.shapeArgs.x=t?d.shapeArgs.x:this.posWidths[r]}translate(){const s=this;var e=s.options;const t=s.chart,o=s.yAxis;var i=o.min;const a=s.options.zoneLines,n=s.priceZones;let r=0,l,h,p,d,u,c,m,g,f;y.translate.apply(s);const v=s.points;v.length&&(c=e.pointPadding<.5?e.pointPadding:.1,e=s.volumeDataArray,l=S(e),h=t.plotWidth/2,m=t.plotTop,p=D(o.toPixels(i)-o.toPixels(i+s.rangeStep)),d=D(o.toPixels(i)-o.toPixels(i+s.rangeStep)),c&&(i=D(p*(1-2*c)),r=D((p-i)/2),p=D(i)),v.forEach(function(e,t){g=e.barX=e.plotX=0,f=e.plotY=o.toPixels(n[t].start)-m-(o.reversed?p-d:p)-r,u=V(h*n[t].wholeVolumeData/l),e.pointWidth=u,e.shapeArgs=s.crispCol.apply(s,[0,f,u,p]),e.volumeNeg=n[t].negativeVolumeData,e.volumePos=n[t].positiveVolumeData,e.volumeAll=n[t].wholeVolumeData}),a.enabled&&s.drawZones(t,o,s.zoneStarts,a.styles))}getValues(e,t){const s=e.processedXData,o=e.processedYData,i=this.chart,a=t.ranges,n=[],r=[],l=[],h=i.get(t.volumeSeriesID);if(e.chart)if(h&&h.processedXData.length){if(!(t=d(o[0]))||4===o[0].length)return(this.priceZones=this.specifyZones(t,s,o,a,h)).forEach(function(e,t){n.push([e.x,e.end]),r.push(n[t][0]),l.push(n[t][1])}),{values:n,xData:r,yData:l};p("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,i)}else p("Series "+t.volumeSeriesID+(h&&!h.processedXData.length?" does not contain any data.":" not found! Check `volumeSeriesID`."),!0,i);else p("Base series not found! In case it has been removed, add a new one.",!0,i)}specifyZones(e,t,s,o,i){if(e){for(var a,n=s.length,r=s[0][3],l=r,h=1;h<n;h++)(a=s[h][3])<r&&(r=a),l<a&&(l=a);n={min:r,max:l}}else n=!1;h=n,n=this.zoneStarts=[],r=[],l=h?h.min:u(s),a=h?h.max:S(s);let p=0;var h=1,d=this.linkedParent;if(!this.options.compareToMain&&d.dataModify&&(l=d.dataModify.modifyValue(l),a=d.dataModify.modifyValue(a)),!c(l)||!c(a))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];for(d=this.rangeStep=V(a-l)/o,n.push(l);p<o-1;p++)n.push(V(n[p]+d));for(n.push(a),o=n.length;h<o;h++)r.push({index:h-1,x:t[0],start:n[h-1],end:n[h]});return this.volumePerZone(e,r,i,t,s)}volumePerZone(s,e,t,o,i){const a=this,n=t.processedXData,r=t.processedYData,l=e.length-1,h=i.length;t=r.length;let p,d,u,c,m;return D(h-t)&&(o[0]!==n[0]&&r.unshift(0),o[h-1]!==n[t-1]&&r.push(0)),a.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,m=e.negativeVolumeData=0;m<h;m++){u=d=!1,c=s?i[m][3]:i[m],p=m?s?i[m-1][3]:i[m-1]:c;const t=a.linkedParent;!a.options.compareToMain&&t.dataModify&&(c=t.dataModify.modifyValue(c),p=t.dataModify.modifyValue(p)),c<=e.start&&0===e.index&&(d=!0),c>=e.end&&e.index===l&&(u=!0),(c>e.start||d)&&(c<e.end||u)&&(e.wholeVolumeData+=r[m],p>c?e.negativeVolumeData+=r[m]:e.positiveVolumeData+=r[m])}a.volumeDataArray.push(e.wholeVolumeData)}),e}drawZones(t,s,e,o){const i=t.renderer,a=t.plotWidth,n=t.plotTop;let r=this.zoneLinesSVG,l=[],h;e.forEach(function(e){h=s.toPixels(e)-n,l=l.concat(t.renderer.crispLine([["M",0,h],["L",a,h]],o.lineWidth))}),r?r.animate({d:l}):r=this.zoneLinesSVG=i.path(l).attr({"stroke-width":o.lineWidth,stroke:o.color,dashstyle:o.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}}return g.defaultOptions=m(r.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"0.5em"},verticalAlign:"top"}}),h(g.prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:e,markerAttribs:t,drawGraph:t,getColumnMetrics:y.getColumnMetrics,crispCol:y.crispCol}),o.registerSeriesType("vbp",g),g}),t(e,"masters/indicators/volume-by-price.src.js",[],function(){})});