!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){function t(e,t,o,i){e.hasOwnProperty(t)||(e[t]=i.apply(null,o),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:t,module:e[t]}})))}t(e=e?e._modules:{},"Stock/Indicators/VBP/VBPPoint.js",[e["Core/Series/SeriesRegistry.js"]],function(e){var i,t,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});return t=e.seriesTypes.sma.prototype.pointClass,o(n,t),n.prototype.destroy=function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),t.prototype.destroy.apply(this,arguments)},n;function n(){return null!==t&&t.apply(this,arguments)||this}}),t(e,"Stock/Indicators/VBP/VBPIndicator.js",[e["Stock/Indicators/VBP/VBPPoint.js"],e["Core/Animation/AnimationUtilities.js"],e["Core/Globals.js"],e["Core/Series/SeriesRegistry.js"],e["Core/Utilities.js"],e["Core/Chart/StockChart.js"]],function(e,t,s,o,i,a){var n,r,p=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),l=t.animObject,h=(t=s.noop,o.seriesTypes.sma),y=o.seriesTypes.column.prototype,d=i.addEvent,g=i.arrayMax,u=i.arrayMin,S=i.correctFloat,c=i.defined,f=i.error,m=i.extend,v=i.isArray,V=i.merge,x=Math.abs;function D(){var e=null!==r&&r.apply(this,arguments)||this;return e.data=void 0,e.negWidths=void 0,e.options=void 0,e.points=void 0,e.posWidths=void 0,e.priceZones=void 0,e.rangeStep=void 0,e.volumeDataArray=void 0,e.zoneStarts=void 0,e.zoneLinesSVG=void 0,e}return p(D,r=h),D.prototype.init=function(e){var t,o,i=this,n=(s.seriesTypes.sma.prototype.init.apply(i,arguments),d(a,"afterLinkSeries",function(){i.options&&(o=i.options.params,t=i.linkedParent,o=e.get(o.volumeSeriesID),i.addCustomEvents(t,o)),n()},{order:1}));return i},D.prototype.addCustomEvents=function(e,t){function o(){i.chart.redraw(),i.setData([]),i.zoneStarts=[],i.zoneLinesSVG&&(i.zoneLinesSVG=i.zoneLinesSVG.destroy())}var i=this;return i.dataEventsToUnbind.push(d(e,"remove",function(){o()})),t&&i.dataEventsToUnbind.push(d(t,"remove",function(){o()})),i},D.prototype.animate=function(e){var o=this,t=o.chart.inverted,i=o.group,n={};!e&&i&&(e=t?o.yAxis.top:o.xAxis.left,t?(i["forceAnimate:translateY"]=!0,n.translateY=e):(i["forceAnimate:translateX"]=!0,n.translateX=e),i.animate(n,m(l(o.options.animation),{step:function(e,t){o.group.attr({scaleX:Math.max(.001,t.pos)})}})))},D.prototype.drawPoints=function(){this.options.volumeDivision.enabled&&(this.posNegVolume(!0,!0),y.drawPoints.apply(this,arguments),this.posNegVolume(!1,!1)),y.drawPoints.apply(this,arguments)},D.prototype.posNegVolume=function(e,t){var o,i=t?["positive","negative"]:["negative","positive"],n=this.options.volumeDivision,s=this.points.length,a=[],r=[],p=0;for(e?(this.posWidths=a,this.negWidths=r):(a=this.posWidths,r=this.negWidths);p<s;p++){var l,h,d=this.points[p];d[i[0]+"Graphic"]=d.graphic,d.graphic=d[i[1]+"Graphic"],e&&(l=d.shapeArgs.width,(o=(h=this.priceZones[p]).wholeVolumeData)?(a.push(l/o*h.positiveVolumeData),r.push(l/o*h.negativeVolumeData)):(a.push(0),r.push(0))),d.color=t?n.styles.positiveColor:n.styles.negativeColor,d.shapeArgs.width=(t?this.posWidths:this.negWidths)[p],d.shapeArgs.x=t?d.shapeArgs.x:this.posWidths[p]}},D.prototype.translate=function(){var o,i,e,n,s,a,r,p,l=this,t=l.options,h=l.chart,d=l.yAxis,u=d.min,c=l.options.zoneLines,f=l.priceZones,m=0,v=(y.translate.apply(l),l.points);v.length&&(e=t.pointPadding<.5?t.pointPadding:.1,t=l.volumeDataArray,n=g(t),s=h.plotWidth/2,a=h.plotTop,r=x(d.toPixels(u)-d.toPixels(u+l.rangeStep)),p=x(d.toPixels(u)-d.toPixels(u+l.rangeStep)),e&&(u=x(r*(1-2*e)),m=x((r-u)/2),r=x(u)),v.forEach(function(e,t){e.barX=e.plotX=0,i=e.plotY=d.toPixels(f[t].start)-a-(d.reversed?r-p:r)-m,o=S(s*f[t].wholeVolumeData/n),e.pointWidth=o,e.shapeArgs=l.crispCol.apply(l,[0,i,o,r]),e.volumeNeg=f[t].negativeVolumeData,e.volumePos=f[t].positiveVolumeData,e.volumeAll=f[t].wholeVolumeData}),c.enabled&&l.drawZones(h,d,l.zoneStarts,c.styles))},D.prototype.getValues=function(e,t){var o,i=e.processedXData,n=e.processedYData,s=this.chart,a=t.ranges,r=[],p=[],l=[];if(e.chart)if(o=s.get(t.volumeSeriesID)){if(!(t=v(n[0]))||4===n[0].length)return(this.priceZones=this.specifyZones(t,i,n,a,o)).forEach(function(e,t){r.push([e.x,e.end]),p.push(r[t][0]),l.push(r[t][1])}),{values:r,xData:p,yData:l};f("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,s)}else f("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,s);else f("Base series not found! In case it has been removed, add a new one.",!0,s)},D.prototype.specifyZones=function(e,t,o,i,n){if(e){for(var s=o.length,a=o[0][3],r=a,p=1;p<s;p++)(l=o[p][3])<a&&(a=l),r<l&&(r=l);s={min:a,max:r}}else s=!1;var s=(a=s)?a.min:u(o),l=a?a.max:g(o),a=this.zoneStarts=[],r=[],h=0,p=1,d=this.linkedParent;if(!this.options.compareToMain&&d.dataModify&&(s=d.dataModify.modifyValue(s),l=d.dataModify.modifyValue(l)),!c(s)||!c(l))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];for(d=this.rangeStep=S(l-s)/i,a.push(s);h<i-1;h++)a.push(S(a[h]+d));for(a.push(l),i=a.length;p<i;p++)r.push({index:p-1,x:t[0],start:a[p-1],end:a[p]});return this.volumePerZone(e,r,n,t,o)},D.prototype.volumePerZone=function(o,e,t,i,n){var s,a,r,p,l,h=this,d=t.processedXData,u=t.processedYData,c=e.length-1,f=n.length;return t=u.length,x(f-t)&&(i[0]!==d[0]&&u.unshift(0),i[f-1]!==d[t-1]&&u.push(0)),h.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,l=e.negativeVolumeData=0;l<f;l++){r=a=!1,p=o?n[l][3]:n[l],s=l?o?n[l-1][3]:n[l-1]:p;var t=h.linkedParent;!h.options.compareToMain&&t.dataModify&&(p=t.dataModify.modifyValue(p),s=t.dataModify.modifyValue(s)),p<=e.start&&0===e.index&&(a=!0),p>=e.end&&e.index===c&&(r=!0),(p>e.start||a)&&(p<e.end||r)&&(e.wholeVolumeData+=u[l],p<s?e.negativeVolumeData+=u[l]:e.positiveVolumeData+=u[l])}h.volumeDataArray.push(e.wholeVolumeData)}),e},D.prototype.drawZones=function(t,o,e,i){var n,s=t.renderer,a=this.zoneLinesSVG,r=[],p=t.plotWidth,l=t.plotTop;e.forEach(function(e){n=o.toPixels(e)-l,r=r.concat(t.renderer.crispLine([["M",0,n],["L",p,n]],i.lineWidth))}),a?a.animate({d:r}):this.zoneLinesSVG=s.path(r).attr({"stroke-width":i.lineWidth,stroke:i.color,dashstyle:i.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)},D.defaultOptions=V(h.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}}),m((i=D).prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:e,markerAttribs:t,drawGraph:t,getColumnMetrics:y.getColumnMetrics,crispCol:y.crispCol}),o.registerSeriesType("vbp",i),i}),t(e,"masters/indicators/volume-by-price.src.js",[],function(){})});