!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function e(t,e,o,i){t.hasOwnProperty(e)||(t[e]=i.apply(null,o),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:e,module:t[e]}})))}e(t=t?t._modules:{},"Stock/Indicators/VBP/VBPPoint.js",[t["Core/Series/SeriesRegistry.js"]],function(t){var i,e,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});return e=t.seriesTypes.sma.prototype.pointClass,o(n,e),n.prototype.destroy=function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),e.prototype.destroy.apply(this,arguments)},n;function n(){return null!==e&&e.apply(this,arguments)||this}}),e(t,"Stock/Indicators/VBP/VBPIndicator.js",[t["Stock/Indicators/VBP/VBPPoint.js"],t["Core/Animation/AnimationUtilities.js"],t["Core/Globals.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"],t["Core/Chart/StockChart.js"]],function(t,e,s,o,i,a){var n,r,p=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),l=e.animObject,h=(e=s.noop,o.seriesTypes),y=h.column.prototype,h=h.sma,d=i.addEvent,g=i.arrayMax,u=i.arrayMin,S=i.correctFloat,c=i.defined,f=i.error,m=i.extend,v=i.isArray,V=i.merge,x=Math.abs;function D(){var t=null!==r&&r.apply(this,arguments)||this;return t.data=void 0,t.negWidths=void 0,t.options=void 0,t.points=void 0,t.posWidths=void 0,t.priceZones=void 0,t.rangeStep=void 0,t.volumeDataArray=void 0,t.zoneStarts=void 0,t.zoneLinesSVG=void 0,t}return p(D,r=h),D.prototype.init=function(t){var e,o,i=this,n=(s.seriesTypes.sma.prototype.init.apply(i,arguments),d(a,"afterLinkSeries",function(){i.options&&(o=i.options.params,e=i.linkedParent,o=t.get(o.volumeSeriesID),i.addCustomEvents(e,o)),n()},{order:1}));return i},D.prototype.addCustomEvents=function(t,e){function o(){i.chart.redraw(),i.setData([]),i.zoneStarts=[],i.zoneLinesSVG&&(i.zoneLinesSVG=i.zoneLinesSVG.destroy())}var i=this;return i.dataEventsToUnbind.push(d(t,"remove",function(){o()})),e&&i.dataEventsToUnbind.push(d(e,"remove",function(){o()})),i},D.prototype.animate=function(t){var o=this,e=o.chart.inverted,i=o.group,n={};!t&&i&&(t=e?o.yAxis.top:o.xAxis.left,e?(i["forceAnimate:translateY"]=!0,n.translateY=t):(i["forceAnimate:translateX"]=!0,n.translateX=t),i.animate(n,m(l(o.options.animation),{step:function(t,e){o.group.attr({scaleX:Math.max(.001,e.pos)})}})))},D.prototype.drawPoints=function(){this.options.volumeDivision.enabled&&(this.posNegVolume(!0,!0),y.drawPoints.apply(this,arguments),this.posNegVolume(!1,!1)),y.drawPoints.apply(this,arguments)},D.prototype.posNegVolume=function(t,e){var o,i=e?["positive","negative"]:["negative","positive"],n=this.options.volumeDivision,s=this.points.length,a=[],r=[],p=0;for(t?(this.posWidths=a,this.negWidths=r):(a=this.posWidths,r=this.negWidths);p<s;p++){var l,h,d=this.points[p];d[i[0]+"Graphic"]=d.graphic,d.graphic=d[i[1]+"Graphic"],t&&(l=d.shapeArgs.width,(o=(h=this.priceZones[p]).wholeVolumeData)?(a.push(l/o*h.positiveVolumeData),r.push(l/o*h.negativeVolumeData)):(a.push(0),r.push(0))),d.color=e?n.styles.positiveColor:n.styles.negativeColor,d.shapeArgs.width=(e?this.posWidths:this.negWidths)[p],d.shapeArgs.x=e?d.shapeArgs.x:this.posWidths[p]}},D.prototype.translate=function(){var o,i,t,n,s,a,r,p,l=this,e=l.options,h=l.chart,d=l.yAxis,u=d.min,c=l.options.zoneLines,f=l.priceZones,m=0,v=(y.translate.apply(l),l.points);v.length&&(t=e.pointPadding<.5?e.pointPadding:.1,e=l.volumeDataArray,n=g(e),s=h.plotWidth/2,a=h.plotTop,r=x(d.toPixels(u)-d.toPixels(u+l.rangeStep)),p=x(d.toPixels(u)-d.toPixels(u+l.rangeStep)),t&&(u=x(r*(1-2*t)),m=x((r-u)/2),r=x(u)),v.forEach(function(t,e){t.barX=t.plotX=0,i=t.plotY=d.toPixels(f[e].start)-a-(d.reversed?r-p:r)-m,o=S(s*f[e].wholeVolumeData/n),t.pointWidth=o,t.shapeArgs=l.crispCol.apply(l,[0,i,o,r]),t.volumeNeg=f[e].negativeVolumeData,t.volumePos=f[e].positiveVolumeData,t.volumeAll=f[e].wholeVolumeData}),c.enabled&&l.drawZones(h,d,l.zoneStarts,c.styles))},D.prototype.getValues=function(t,e){var o,i=t.processedXData,n=t.processedYData,s=this.chart,a=e.ranges,r=[],p=[],l=[];if(t.chart)if(o=s.get(e.volumeSeriesID)){if(!(e=v(n[0]))||4===n[0].length)return(this.priceZones=this.specifyZones(e,i,n,a,o)).forEach(function(t,e){r.push([t.x,t.end]),p.push(r[e][0]),l.push(r[e][1])}),{values:r,xData:p,yData:l};f("Type of "+t.name+" series is different than line, OHLC or candlestick.",!0,s)}else f("Series "+e.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,s);else f("Base series not found! In case it has been removed, add a new one.",!0,s)},D.prototype.specifyZones=function(t,e,o,i,n){if(t){for(var s=o.length,a=o[0][3],r=a,p=1;p<s;p++)(l=o[p][3])<a&&(a=l),r<l&&(r=l);s={min:a,max:r}}else s=!1;var s=(a=s)?a.min:u(o),l=a?a.max:g(o),a=this.zoneStarts=[],r=[],h=0,p=1,d=this.linkedParent;if(!this.options.compareToMain&&d.dataModify&&(s=d.dataModify.modifyValue(s),l=d.dataModify.modifyValue(l)),!c(s)||!c(l))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];for(d=this.rangeStep=S(l-s)/i,a.push(s);h<i-1;h++)a.push(S(a[h]+d));for(a.push(l),i=a.length;p<i;p++)r.push({index:p-1,x:e[0],start:a[p-1],end:a[p]});return this.volumePerZone(t,r,n,e,o)},D.prototype.volumePerZone=function(o,t,e,i,n){var s,a,r,p,l,h=this,d=e.processedXData,u=e.processedYData,c=t.length-1,f=n.length;return e=u.length,x(f-e)&&(i[0]!==d[0]&&u.unshift(0),i[f-1]!==d[e-1]&&u.push(0)),h.volumeDataArray=[],t.forEach(function(t){for(t.wholeVolumeData=0,t.positiveVolumeData=0,l=t.negativeVolumeData=0;l<f;l++){r=a=!1,p=o?n[l][3]:n[l],s=l?o?n[l-1][3]:n[l-1]:p;var e=h.linkedParent;!h.options.compareToMain&&e.dataModify&&(p=e.dataModify.modifyValue(p),s=e.dataModify.modifyValue(s)),p<=t.start&&0===t.index&&(a=!0),p>=t.end&&t.index===c&&(r=!0),(p>t.start||a)&&(p<t.end||r)&&(t.wholeVolumeData+=u[l],p<s?t.negativeVolumeData+=u[l]:t.positiveVolumeData+=u[l])}h.volumeDataArray.push(t.wholeVolumeData)}),t},D.prototype.drawZones=function(e,o,t,i){var n,s=e.renderer,a=this.zoneLinesSVG,r=[],p=e.plotWidth,l=e.plotTop;t.forEach(function(t){n=o.toPixels(t)-l,r=r.concat(e.renderer.crispLine([["M",0,n],["L",p,n]],i.lineWidth))}),a?a.animate({d:r}):this.zoneLinesSVG=s.path(r).attr({"stroke-width":i.lineWidth,stroke:i.color,dashstyle:i.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)},D.defaultOptions=V(h.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}}),m((i=D).prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:t,markerAttribs:e,drawGraph:e,getColumnMetrics:y.getColumnMetrics,crispCol:y.crispCol}),o.registerSeriesType("vbp",i),i}),e(t,"masters/indicators/volume-by-price.src.js",[],function(){})});